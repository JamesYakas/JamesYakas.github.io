Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C");var suburb=localStorage.getItem("usersSuburb"),initialSearch=!0,_typeOfSpecial=["Drink"],masterEstablishments=[],masterMarkers=[],filteredMarkers=[],useFilteredMarkers=!1,lat=0,lng=0,state="filtered-list";function pageOnLoad(){if(!initialSearch){useFilteredMarkers=!1,document.getElementById("tabDrink").classList.add("active"),$("#daysOfWeekFilter").val(""),document.getElementById("timePeriodStartFilter").selectedIndex="0",document.getElementById("timePeriodEndFilter").selectedIndex="16",$("#specialCategoryFilter").val("");for(i=0,l={},a=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],n=0;n<a.length;n++)l[a[n]]=n;var e=Backendless.DataQueryBuilder.create();return e.setRelated(["establishmentSpecials"]),e.setWhereClause("Suburb = '"+suburb+"'"),Backendless.Data.of("Establishment").find(e).then(function(e){document.getElementById("rpList").innerHTML="";for(var t=["Drink"],s=e.reduce((e,s)=>{const l=s.establishmentSpecials.filter(e=>t.includes(e.Type_Of_Special));return l.length>0?[...e,{...s,establishmentSpecials:l}]:e},[]),a=0;a<s.length;a++)if(console.log(s),s[a].establishmentSpecials.length>0){s[a].establishmentSpecials.sort(function(e,t){return l[e.Category]-l[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+s[a].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+s[a].Image+'"><br><b>'+s[a].Name+"</b><br>"+s[a].Cuisine_Type+"<br>"+s[a].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\'  class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+s[a].objectId+'"></tbody></table></div>';for(var n=0;n<s[a].establishmentSpecials.length;n++){var r,o=document.getElementById("myTable"+s[a].objectId);r=s[a].establishmentSpecials[n].Days_Of_Week.split(", "),console.log(r);for(var c="M ",d="T ",p="W ",m="T ",g="F ",b="S ",u="S",h=0;h<r.length;h++)"Monday"==r[h]?c=c.fontcolor("#FF3399"):"Tuesday"==r[h]?d=d.fontcolor("#FF3399"):"Wednesday"==r[h]?p=p.fontcolor("#FF3399"):"Thursday"==r[h]?m=m.fontcolor("#FF3399"):"Friday"==r[h]?g=g.fontcolor("#FF3399"):"Saturday"==r[h]?b=b.fontcolor("#FF3399"):"Sunday"==r[h]&&(u=u.fontcolor("#FF3399"));addRow(o,'<div class="category">'+s[a].establishmentSpecials[n].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(s[a].establishmentSpecials[n].Start_Time)+" - "+tConvert(s[a].establishmentSpecials[n].End_Time)+"</div>",s[a].establishmentSpecials[n].objectId),addRowBottom(o,s[a].establishmentSpecials[n].Description,'<div class="daysAbbreviated">'+c+d+p+m+g+b+u+"</div>",s[a].establishmentSpecials[n].objectId),i++}document.getElementById("rpList").innerHTML+="<br>"}var y=document.getElementById("cusineTypeFilter");$("#cusineTypeFilter").empty();var f=0,S=e.length,v=[],I=0;for(f=0;f<S;f++){var k=!1;for(I=0;I<e[f].establishmentSpecials.length;I++)if("Food"==e[f].establishmentSpecials[I].Type_Of_Special){console.log(e[f].Name),k=!0;break}if(1==k){if(e[f].Cuisine_Type.includes(", ")){var E=e[f].Cuisine_Type;console.log(E);for(var F=E.split(", "),T=0,C=F.length;T<C;T++)v.push(F[T]);console.log(F)}else v.push(e[f].Cuisine_Type);0}}var B=v.filter(onlyUnique);B.sort();var _=1,L=0,O=B.length;for(L=0;L<O;L++)y.options[0]=new Option("Any",""),y.options[0].disabled=!0,y.options[_]=new Option(B[L],B[L]),_++;var j,D=document.querySelectorAll("#foodDrink");M.Tabs.init(D,{duration:100}),document.getElementById("tabDrink").classList.add("active"),_typeOfSpecial=["Drink"],masterEstablishments=e,console.log(e),document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+i+"' matching Drink specials",j=e.length>0?e[0].Postcode:"No results",document.getElementById("rpDisplaySuburb").innerHTML=suburb.fontsize(6)+" Specials ".fontsize(6)+"- "+j,"block"==document.getElementById("rpGoogleMap").style.display&&(document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("rpbtnList").style.backgroundColor="#22aa1e",document.getElementById("rpBtnMap").style.backgroundColor="lightgray"),document.getElementById("cusineTypeFilter").disabled=!0,$("select").formSelect(),console.log("1. Populate list")}).then(()=>{var e=suburb;return axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:e,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){lat=e.data.results[0].geometry.location.lat,lng=e.data.results[0].geometry.location.lng,console.log("2. Get suburb coords")}).then(()=>{console.log("3. Start map markers creation");for(var e=0;e<masterEstablishments.length;e++)if(masterEstablishments[e].establishmentSpecials.length>0){console.log("4.1 Start creating a single marker");masterMarkers.push({coords:{lat:masterEstablishments[e].Location.y,lng:masterEstablishments[e].Location.x},iconImage:"images/restaurant.png",content:masterEstablishments[e].Name+"<br>"+masterEstablishments[e].Cuisine_Type+"<br>"+masterEstablishments[e].Address+"<br>",Cuisine_Type:masterEstablishments[e].Cuisine_Type,establishmentSpecials:masterEstablishments[e].establishmentSpecials}),console.log("4.2 Finish creating a single marker")}console.log("5. Finish map markers creation")}).then(()=>{console.log("6. Initialize map")})}).catch(function(e){})}var t=sessionStorage.getItem("suburbResults"),s=JSON.parse(t);document.getElementById("rpList").innerHTML="";for(var l={},a=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],n=0;n<a.length;n++)l[a[n]]=n;for(var i=0,r=["Drink"],o=s.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>r.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]),n=0;n<o.length;n++)if(o[n].establishmentSpecials.length>0){o[n].establishmentSpecials.sort(function(e,t){return l[e.Category]-l[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+o[n].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+o[n].Image+'"><br><b>'+o[n].Name+"</b><br>"+o[n].Cuisine_Type+"<br>"+o[n].objectId+"<br>"+o[n].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+o[n].objectId+'"></tbody></table></div>';for(var c=0;c<o[n].establishmentSpecials.length;c++){var d,p=document.getElementById("myTable"+o[n].objectId);d=o[n].establishmentSpecials[c].Days_Of_Week.split(", ");for(var m="M ",g="T ",b="W ",u="T ",h="F ",y="S ",f="S",S=0;S<d.length;S++)"Monday"==d[S]?m=m.fontcolor("#FF3399"):"Tuesday"==d[S]?g=g.fontcolor("#FF3399"):"Wednesday"==d[S]?b=b.fontcolor("#FF3399"):"Thursday"==d[S]?u=u.fontcolor("#FF3399"):"Friday"==d[S]?h=h.fontcolor("#FF3399"):"Saturday"==d[S]?y=y.fontcolor("#FF3399"):"Sunday"==d[S]&&(f=f.fontcolor("#FF3399"));addRow(p,'<div class="category">'+o[n].establishmentSpecials[c].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(o[n].establishmentSpecials[c].Start_Time)+" - "+tConvert(o[n].establishmentSpecials[c].End_Time)+"</div>",o[n].establishmentSpecials[c].objectId),addRowBottom(p,o[n].establishmentSpecials[c].Description,'<div class="daysAbbreviated">'+m+g+b+u+h+y+f+"</div>",o[n].establishmentSpecials[c].objectId),i++}document.getElementById("rpList").innerHTML+="<br>"}var v=document.getElementById("cusineTypeFilter");$("#cusineTypeFilter").empty();var I=0,k=s.length,E=[],F=0;for(I=0;I<k;I++){var T=!1;for(F=0;F<s[I].establishmentSpecials.length;F++)if("Food"==s[I].establishmentSpecials[F].Type_Of_Special){console.log(s[I].Name),T=!0;break}if(1==T){if(s[I].Cuisine_Type.includes(", ")){var C=s[I].Cuisine_Type;console.log(C);for(var B=C.split(", "),_=0,L=B.length;_<L;_++)E.push(B[_]);console.log(B)}else E.push(s[I].Cuisine_Type);0}}console.log(E);var O=E.filter(onlyUnique);O.sort(),console.log(O);var j=1,D=0,w=O.length;for(D=0;D<w;D++)v.options[0]=new Option("Any",""),v.options[0].disabled=!0,v.options[j]=new Option(O[D],O[D]),j++;var A,H=document.querySelectorAll("#foodDrink");M.Tabs.init(H,{duration:100}),masterEstablishments=s,A=o.length>0?o[0].Postcode:"No results",document.getElementById("rpDisplaySuburb").innerHTML=suburb.fontsize(6)+" Specials - ".fontsize(6)+A,console.log("1. Populate list"),document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+i+"' matching Drink specials",document.getElementById("rpbtnList").style.backgroundColor="#22aa1e";H=document.querySelectorAll("select");if(instances=M.FormSelect.init(H),console.log("State: "+state),initialSearch){var W=suburb;return axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:W,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){lat=e.data.results[0].geometry.location.lat,lng=e.data.results[0].geometry.location.lng,console.log("2. Get suburb coords")}).then(()=>{console.log("3. Start map markers creation");for(var e=0;e<masterEstablishments.length;e++)if(masterEstablishments[e].establishmentSpecials.length>0){console.log("4.1 Start creating a single marker");masterMarkers.push({coords:{lat:masterEstablishments[e].Location.coordinates[1],lng:masterEstablishments[e].Location.coordinates[0]},iconImage:"images/restaurant.png",content:masterEstablishments[e].Name+"<br>"+masterEstablishments[e].Cuisine_Type+"<br>"+masterEstablishments[e].Address,Cuisine_Type:masterEstablishments[e].Cuisine_Type,establishmentSpecials:masterEstablishments[e].establishmentSpecials,objectId:masterEstablishments[e].objectId}),console.log("4.2 Finish creating a single marker")}console.log("5. Finish map markers creation")}).catch(function(e){}).then(()=>{console.log("6. Initialize map")})}}function initMap(){console.log("7. Map Initialization started");var e={zoom:13,center:{lat:lat,lng:lng}};console.log("8. Start print markers"),console.log("9. End print markers");var t,s=new google.maps.Map(document.getElementById("rpGoogleMap"),e);if(console.log("Running first time"),console.log("10. Map created"),console.log("10.1 clear markers"),console.log(useFilteredMarkers),0==useFilteredMarkers)for(var l=0;l<masterMarkers.length;l++)a(masterMarkers[l]);else for(l=0;l<filteredMarkers.length;l++)a(filteredMarkers[l]);function a(e){var l=new google.maps.Marker({position:e.coords,map:s,Cuisine_Type:e.Cusine_Type,establishmentSpecials:e.establishmentSpecials,objectId:e.objectId});if(e.iconImage&&l.setIcon(e.iconImage),e.content){var a=new google.maps.InfoWindow({content:e.content});l.addListener("click",function(){t&&t.close(),a.open(s,l),t=a})}}console.log("11. Markers added")}function setMapOnAll(e){for(var t=0;t<filteredMarkers.length;t++)filteredMarkers[t].setMap(e)}function clearMarkers(){setMapOnAll(null),filteredMarkers=[]}function deleteMarkers(){for(var e=0;e<filteredMarkers.length;e++)filteredMarkers[e].setMap(null);filteredMarkers=[]}function daysOfWeekFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function timePeriodFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function specialCategoryFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function cusineTypeFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function establishmentTypeFilter(){state="filtered-list",console.log("State: "+state),applyFilters()}function typeOfSpecialFilterDrink(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!0,$("select").formSelect(),_typeOfSpecial=["Drink"],state="filtered-list",console.log("State: "+state),applyFilters()}function typeOfSpecialFilterFood(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!1,$("select").formSelect(),_typeOfSpecial=["Food"],state="filtered-list",console.log("State: "+state),applyFilters()}function applyFilters(){var e=$("#daysOfWeekFilter").val(),t=$("#timePeriodStartFilter").val(),s=$("#timePeriodEndFilter").val(),l=$("#specialCategoryFilter").val(),a=$("#cusineTypeFilter").val(),n=_typeOfSpecial;console.log(n);for(var i=masterEstablishments,r=[],o=0;o<i.length;o++)for(var c=0;c<i[o].establishmentSpecials.length;c++){var d=[];if(i[o].establishmentSpecials[c].Days_Of_Week.includes(", "))for(var p=i[o].establishmentSpecials[c].Days_Of_Week.split(", "),m=0,g=p.length;m<g;m++)d.push(p[m]);else d.push(i[o].establishmentSpecials[c].Days_Of_Week);for(var b=0;b<e.length;b++)1==d.includes(e[b])&&r.push(i[o].establishmentSpecials[c].objectId)}console.log(r),e.length>=1&&r.length>=0&&(i=i.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>r.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var u=60*t.substring(0,2)+ +t.substring(3,5),h=60*s.substring(0,2)+ +s.substring(3,5),y=[],f=[];for(o=0;o<i.length;o++)for(c=0;c<i[o].establishmentSpecials.length;c++){var S=i[o].establishmentSpecials[c].Start_Time,v=i[o].establishmentSpecials[c].End_Time;S=60*S.substring(0,2)+ +S.substring(3,5),(v=60*v.substring(0,2)+ +v.substring(3,5))>u&&S<h&&(y.push(i[o].establishmentSpecials[c]),f.push(i[o].establishmentSpecials[c].objectId))}if(f.length>=0&&(i=i.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>f.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),l.length>=1&&(i=i.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>l.includes(e.Category));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),"Food"==_typeOfSpecial[0]){var I=[],k=[];for(o=0;o<i.length;o++){var E=[];if(i[o].Cuisine_Type.includes(", ")){var F=i[o].Cuisine_Type.split(", ");for(m=0,g=F.length;m<g;m++)E.push(F[m])}else E.push(i[o].Cuisine_Type);for(b=0;b<a.length;b++)1==E.includes(a[b])&&(k.push(i[o]),I.push(i[o].objectId))}console.log(k),console.log(a),console.log(I),a.length>=1&&(i=i.filter(e=>I.includes(e.objectId)))}n.length>=1&&(i=i.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>n.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var M={},T=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"];for(o=0;o<T.length;o++)M[T[o]]=o;var C=0;if("establishment-page-map"!=state){document.getElementById("rpList").innerHTML="";for(o=0;o<i.length;o++){i[o].establishmentSpecials.sort(function(e,t){return M[e.Category]-M[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+i[o].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+i[o].Image+'"><br><b>'+i[o].Name+"</b><br>"+i[o].Cuisine_Type+"<br>"+i[o].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+i[o].objectId+'"></tbody></table></div>';for(c=0;c<i[o].establishmentSpecials.length;c++){var B,_=document.getElementById("myTable"+i[o].objectId);B=i[o].establishmentSpecials[c].Days_Of_Week.split(", ");for(var L="M ",O="T ",j="W ",D="T ",w="F ",A="S ",H="S",W=0;W<B.length;W++)"Monday"==B[W]?L=L.fontcolor("#FF3399"):"Tuesday"==B[W]?O=O.fontcolor("#FF3399"):"Wednesday"==B[W]?j=j.fontcolor("#FF3399"):"Thursday"==B[W]?D=D.fontcolor("#FF3399"):"Friday"==B[W]?w=w.fontcolor("#FF3399"):"Saturday"==B[W]?A=A.fontcolor("#FF3399"):"Sunday"==B[W]&&(H=H.fontcolor("#FF3399"));addRow(_,'<div class="category">'+i[o].establishmentSpecials[c].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(i[o].establishmentSpecials[c].Start_Time)+" - "+tConvert(i[o].establishmentSpecials[c].End_Time)+"</div>",i[o].establishmentSpecials[c].objectId),addRowBottom(_,i[o].establishmentSpecials[c].Description,'<div class="daysAbbreviated">'+L+O+j+D+w+A+H+"</div>",i[o].establishmentSpecials[c].objectId),C++}document.getElementById("rpList").innerHTML+="<br>"}document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+C+"' matching "+_typeOfSpecial[0]+" specials"}if("block"==document.getElementById("rpGoogleMap").style.display){if(console.log("Map displayed"),useFilteredMarkers=!0,"establishment-page-map"==state)console.log("State: Display establishment map marker"),filteredMarkers=masterMarkers.filter(e=>e.content.includes(document.getElementById("rpNumOfSpecialsFound").innerHTML));else{filteredMarkers=masterMarkers,console.log(masterEstablishments),console.log(filteredMarkers);var R=[];for(o=0;o<filteredMarkers.length;o++)for(c=0;c<filteredMarkers[o].establishmentSpecials.length;c++){var N=[];if(filteredMarkers[o].establishmentSpecials[c].Days_Of_Week.includes(", ")){var z=filteredMarkers[o].establishmentSpecials[c].Days_Of_Week.split(", ");for(m=0,g=z.length;m<g;m++)N.push(z[m])}else N.push(filteredMarkers[o].establishmentSpecials[c].Days_Of_Week);for(b=0;b<e.length;b++)1==N.includes(e[b])&&R.push(filteredMarkers[o].establishmentSpecials[c].objectId)}console.log(R),e.length>=1&&R.length>=0&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>R.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var G=60*t.substring(0,2)+ +t.substring(3,5),P=60*s.substring(0,2)+ +s.substring(3,5),U=[],q=[];for(o=0;o<filteredMarkers.length;o++)for(c=0;c<filteredMarkers[o].establishmentSpecials.length;c++){var x=filteredMarkers[o].establishmentSpecials[c].Start_Time,X=filteredMarkers[o].establishmentSpecials[c].End_Time;x=60*x.substring(0,2)+ +x.substring(3,5),(X=60*X.substring(0,2)+ +X.substring(3,5))>G&&x<P&&(U.push(filteredMarkers[o].establishmentSpecials[c]),q.push(filteredMarkers[o].establishmentSpecials[c].objectId))}q.length>=0&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>q.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),l.length>=1&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>l.includes(e.Category));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var J=[],Q=[];for(o=0;o<filteredMarkers.length;o++){var K=[];if(filteredMarkers[o].Cuisine_Type.includes(", ")){var V=filteredMarkers[o].Cuisine_Type.split(", ");for(m=0,g=V.length;m<g;m++)K.push(V[m])}else K.push(filteredMarkers[o].Cuisine_Type);for(b=0;b<a.length;b++)1==K.includes(a[b])&&(Q.push(filteredMarkers[o]),J.push(filteredMarkers[o].objectId))}console.log(Q),console.log(a),console.log(J),a.length>=1&&(filteredMarkers=filteredMarkers.filter(e=>J.includes(e.objectId))),n.length>=1&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>n.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]))}initMap()}}function btnShowList(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!1,$("select").formSelect(),"establishment-page-map"==state?(state="establishment-page",console.log("State: "+state)):"establishment-page"==state?(state="filtered-list",console.log("State: "+state),applyFilters()):(state="filtered-list")&&console.log("State: "+state),document.getElementById("rpbtnList").style.backgroundColor="#22aa1e",document.getElementById("rpBtnMap").style.backgroundColor="lightgray"}function btnShowMap(){document.getElementById("rpList").style.display="none",document.getElementById("rpGoogleMap").style.display="block","filtered-list"==state&&(state="filtered-list-map",console.log("State: "+state)),"establishment-page"==state&&(state="establishment-page-map",console.log("State: "+state)),applyFilters(),document.getElementById("rpbtnList").style.backgroundColor="lightgray",document.getElementById("rpBtnMap").style.backgroundColor="#22aa1e"}function onlyUnique(e,t,s){return s.indexOf(e)===t}function addCellTop(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.colSpan=2,l.classList.add("cellTopCSS"),e.appendChild(l)}function addCell(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.classList.add("cellCSS"),e.appendChild(l)}function addCellBottom(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.classList.add("cellBottomCSS"),e.appendChild(l)}function addRowTop(e,t,s){var l=document.createElement("tr");l.id=s,addCellTop(l,t),e.appendChild(l)}function addRow(e,t,s,l){var a=document.createElement("tr");a.id=l,addCell(a,t),addCell(a,s),e.appendChild(a)}function addRowBottom(e,t,s,l){var a=document.createElement("tr");a.id=l,addCellBottom(a,t),addCellBottom(a,s),e.appendChild(a)}function research(){initialSearch=!1,suburb=document.getElementById("rpReSearchInputDiv").value,localStorage.setItem("usersSuburb",suburb),masterEstablishments=[],masterMarkers=[],pageOnLoad()}function tConvert(e){return(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).length>1&&((e=e.slice(1))[5]=+e[0]<12?" AM":" PM",e[0]=+e[0]%12||12),e.join("")}function testing(){console.log(filteredMarkers),setMapOnAll(null)}function setMapOnAll(e){for(var t=0;t<filteredMarkers.length;t++)console.log(filteredMarkers[t].coords.lat),filteredMarkers.setMap(e)}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll("select");instances=M.FormSelect.init(e),pageOnLoad()}),$(document).on("click","#viewEstablishmentPage",function(){var e=$(this).attr("data-id");console.log(masterEstablishments);for(var t=document.getElementById("myTable"+e),s=0,l=masterEstablishments.length;s<l;s++)if(e==masterEstablishments[s].objectId){document.getElementById("rpList").innerHTML='<div class="establishment-wrapper"><img class="rpImage" src="'+masterEstablishments[s].Image+'"><br><b>'+masterEstablishments[s].Name+"</b><br>"+masterEstablishments[s].Cuisine_Type+"<br>"+masterEstablishments[s].objectId+"<br>"+masterEstablishments[s].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+s+'"></tbody></table></div>';for(var a=[],n=0,i=t.rows.length;n<i;n++)a.push(t.rows[n].id),n++;console.log("Object IDs:"),console.log(a);var r=[],o=masterEstablishments[s];console.log("Establishment"),console.log(o);var c=[],d=0,p=o.establishmentSpecials.length;console.log("Establishment's number of specials: "+p);for(d=0;d<p;d++)c.push(o.establishmentSpecials[d]);console.log("Establishment's specials: "),console.log(c);for(var m=c,g=c,b={},u=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],h=0;h<u.length;h++)b[u[h]]=h;var y=[];(y=m.filter(e=>!a.includes(e.objectId))).sort(function(e,t){return b[e.Category]-b[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),console.log("Sorted - Other establishment specials: "),console.log(y),(r=g.filter(e=>a.includes(e.objectId))).sort(function(e,t){return b[e.Category]-b[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),console.log("Sorted - establishment specials"),console.log(r);for(var f=0,S=y.length;f<S;f++)y[f].otherSpecials=void 0;y.length>0&&(y[0].otherSpecials="yes"),console.log("otherSpecials = undefined"),console.log(y);var v=[];v=r.concat(y);console.log(v);for(var I=0;I<v.length;I++){var k,E=document.getElementById("myTable"+s);k=v[I].Days_Of_Week.split(", ");for(var F="M ",M="T ",T="W ",C="T ",B="F ",_="S ",L="S",O=0;O<k.length;O++)"Monday"==k[O]?F=F.fontcolor("#FF3399"):"Tuesday"==k[O]?M=M.fontcolor("#FF3399"):"Wednesday"==k[O]?T=T.fontcolor("#FF3399"):"Thursday"==k[O]?C=C.fontcolor("#FF3399"):"Friday"==k[O]?B=B.fontcolor("#FF3399"):"Saturday"==k[O]?_=_.fontcolor("#FF3399"):"Sunday"==k[O]&&(L=L.fontcolor("#FF3399"));0==I?(addRowTop(E,"Specials matching your search criteria",v[I].objectId),addRow(E,'<div class="category">'+v[I].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[I].Start_Time)+" - "+tConvert(v[I].End_Time)+"</div>",v[I].objectId),addRowBottom(E,v[I].Description,'<div class="daysAbbreviated">'+F+M+T+C+B+_+L+"</div>",v[I].objectId)):"yes"==v[I].otherSpecials?(console.log(v[I].Description),addRowTop(E,"Other specials on offer",v[I].objectId),addRow(E,'<div class="category">'+v[I].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[I].Start_Time)+" - "+tConvert(v[I].End_Time)+"</div>",v[I].objectId),addRowBottom(E,v[I].Description,'<div class="daysAbbreviated">'+F+M+T+C+B+_+L+"</div>",v[I].objectId)):(addRow(E,'<div class="category">'+v[I].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[I].Start_Time)+" - "+tConvert(v[I].End_Time)+"</div>",v[I].objectId),addRowBottom(E,v[I].Description,'<div class="daysAbbreviated">'+F+M+T+C+B+_+L+"</div>",v[I].objectId))}document.getElementById("rpNumOfSpecialsFound").innerHTML=masterEstablishments[s].Name}state="establishment-page",console.log("State: "+state)});