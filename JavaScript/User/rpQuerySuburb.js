Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C");var suburb=localStorage.getItem("usersSuburb"),initialSearch=!0,_typeOfSpecial=["Drink"],masterEstablishments=[],masterMarkers=[],filteredMarkers=[],useFilteredMarkers=!1,lat=0,lng=0,state="filtered-list";function pageOnLoad(){if(!initialSearch){useFilteredMarkers=!1,document.getElementById("tabDrink").classList.add("active"),$("#daysOfWeekFilter").val(""),document.getElementById("timePeriodStartFilter").selectedIndex="0",document.getElementById("timePeriodEndFilter").selectedIndex="16",$("#specialCategoryFilter").val("");for(n=0,l={},a=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],i=0;i<a.length;i++)l[a[i]]=i;var e=Backendless.DataQueryBuilder.create();return e.setRelated(["establishmentSpecials"]),e.setWhereClause("Suburb = '"+suburb+"'"),Backendless.Data.of("Establishment").find(e).then(function(e){document.getElementById("rpList").innerHTML="";for(var t=["Drink"],s=e.reduce((e,s)=>{const l=s.establishmentSpecials.filter(e=>t.includes(e.Type_Of_Special));return l.length>0?[...e,{...s,establishmentSpecials:l}]:e},[]),a=0;a<s.length;a++)if(console.log(s),s[a].establishmentSpecials.length>0){s[a].establishmentSpecials.sort(function(e,t){return l[e.Category]-l[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+s[a].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+s[a].Image+'"><br><b>'+s[a].Name+"</b><br>"+s[a].Cuisine_Type+"<br>"+s[a].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\'  class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+s[a].objectId+'"></tbody></table></div>';for(var i=0;i<s[a].establishmentSpecials.length;i++){var r,o=document.getElementById("myTable"+s[a].objectId);r=s[a].establishmentSpecials[i].Days_Of_Week.split(", "),console.log(r);for(var c="M ",d="T ",p="W ",m="T ",b="F ",g="S ",u="S",h=0;h<r.length;h++)"Monday"==r[h]?c=c.fontcolor("#FF3399"):"Tuesday"==r[h]?d=d.fontcolor("#FF3399"):"Wednesday"==r[h]?p=p.fontcolor("#FF3399"):"Thursday"==r[h]?m=m.fontcolor("#FF3399"):"Friday"==r[h]?b=b.fontcolor("#FF3399"):"Saturday"==r[h]?g=g.fontcolor("#FF3399"):"Sunday"==r[h]&&(u=u.fontcolor("#FF3399"));addRow(o,'<div class="category">'+s[a].establishmentSpecials[i].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(s[a].establishmentSpecials[i].Start_Time)+" - "+tConvert(s[a].establishmentSpecials[i].End_Time)+"</div>",s[a].establishmentSpecials[i].objectId),addRowBottom(o,s[a].establishmentSpecials[i].Description,'<div class="daysAbbreviated">'+c+d+p+m+b+g+u+"</div>",s[a].establishmentSpecials[i].objectId),n++}document.getElementById("rpList").innerHTML+="<br>"}var y=document.getElementById("cusineTypeFilter");$("#cusineTypeFilter").empty();var f=0,S=e.length,v=[],F=0;for(f=0;f<S;f++){var I=!1;for(F=0;F<e[f].establishmentSpecials.length;F++)if("Food"==e[f].establishmentSpecials[F].Type_Of_Special){console.log(e[f].Name),I=!0;break}if(1==I){if(e[f].Cuisine_Type.includes(", ")){var T=e[f].Cuisine_Type;console.log(T);for(var k=T.split(", "),E=0,_=k.length;E<_;E++)v.push(k[E]);console.log(k)}else v.push(e[f].Cuisine_Type);0}}var C=v.filter(onlyUnique);C.sort();var B=1,L=0,O=C.length;for(L=0;L<O;L++)y.options[0]=new Option("Any",""),y.options[0].disabled=!0,y.options[B]=new Option(C[L],C[L]),B++;var j,D=document.querySelectorAll("#foodDrink");M.Tabs.init(D,{duration:100}),document.getElementById("tabDrink").classList.add("active"),_typeOfSpecial=["Drink"],masterEstablishments=e,console.log(e),document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+n+"' matching Drink specials",j=e.length>0?e[0].Postcode:"No results",document.getElementById("rpDisplaySuburb").innerHTML=suburb.fontsize(6)+" Specials ".fontsize(6)+"- "+j,document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!0,$("select").formSelect(),console.log("1. Populate list")}).then(()=>{var e=suburb;return axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:e,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){lat=e.data.results[0].geometry.location.lat,lng=e.data.results[0].geometry.location.lng,console.log("2. Get suburb coords")}).then(()=>{console.log("3. Start map markers creation");for(var e=0;e<masterEstablishments.length;e++)if(masterEstablishments[e].establishmentSpecials.length>0){console.log("4.1 Start creating a single marker");masterMarkers.push({coords:{lat:masterEstablishments[e].Location.y,lng:masterEstablishments[e].Location.x},iconImage:"images/restaurant.png",content:'<a href="establishment.html">'+masterEstablishments[e].Name+"</a><br>"+masterEstablishments[e].Cuisine_Type+"<br>"+masterEstablishments[e].Address+"<br>",Cuisine_Type:masterEstablishments[e].Cuisine_Type,establishmentSpecials:masterEstablishments[e].establishmentSpecials}),console.log("4.2 Finish creating a single marker")}console.log("5. Finish map markers creation")}).then(()=>{console.log("6. Initialize map")})}).catch(function(e){})}var t=sessionStorage.getItem("suburbResults"),s=JSON.parse(t);document.getElementById("rpList").innerHTML="";for(var l={},a=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],i=0;i<a.length;i++)l[a[i]]=i;for(var n=0,r=["Drink"],o=s.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>r.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]),i=0;i<o.length;i++)if(o[i].establishmentSpecials.length>0){o[i].establishmentSpecials.sort(function(e,t){return l[e.Category]-l[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+o[i].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+o[i].Image+'"><br><b>'+o[i].Name+"</b><br>"+o[i].Cuisine_Type+"<br>"+o[i].objectId+"<br>"+o[i].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+o[i].objectId+'"></tbody></table></div>';for(var c=0;c<o[i].establishmentSpecials.length;c++){var d,p=document.getElementById("myTable"+o[i].objectId);d=o[i].establishmentSpecials[c].Days_Of_Week.split(", ");for(var m="M ",b="T ",g="W ",u="T ",h="F ",y="S ",f="S",S=0;S<d.length;S++)"Monday"==d[S]?m=m.fontcolor("#FF3399"):"Tuesday"==d[S]?b=b.fontcolor("#FF3399"):"Wednesday"==d[S]?g=g.fontcolor("#FF3399"):"Thursday"==d[S]?u=u.fontcolor("#FF3399"):"Friday"==d[S]?h=h.fontcolor("#FF3399"):"Saturday"==d[S]?y=y.fontcolor("#FF3399"):"Sunday"==d[S]&&(f=f.fontcolor("#FF3399"));addRow(p,'<div class="category">'+o[i].establishmentSpecials[c].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(o[i].establishmentSpecials[c].Start_Time)+" - "+tConvert(o[i].establishmentSpecials[c].End_Time)+"</div>",o[i].establishmentSpecials[c].objectId),addRowBottom(p,o[i].establishmentSpecials[c].Description,'<div class="daysAbbreviated">'+m+b+g+u+h+y+f+"</div>",o[i].establishmentSpecials[c].objectId),n++}document.getElementById("rpList").innerHTML+="<br>"}var v=document.getElementById("cusineTypeFilter");$("#cusineTypeFilter").empty();var F=0,I=s.length,T=[],k=0;for(F=0;F<I;F++){var E=!1;for(k=0;k<s[F].establishmentSpecials.length;k++)if("Food"==s[F].establishmentSpecials[k].Type_Of_Special){console.log(s[F].Name),E=!0;break}if(1==E){if(s[F].Cuisine_Type.includes(", ")){var _=s[F].Cuisine_Type;console.log(_);for(var C=_.split(", "),B=0,L=C.length;B<L;B++)T.push(C[B]);console.log(C)}else T.push(s[F].Cuisine_Type);0}}console.log(T);var O=T.filter(onlyUnique);O.sort(),console.log(O);var j=1,D=0,w=O.length;for(D=0;D<w;D++)v.options[0]=new Option("Any",""),v.options[0].disabled=!0,v.options[j]=new Option(O[D],O[D]),j++;$("select").formSelect();var A,H=document.querySelectorAll("#foodDrink");M.Tabs.init(H,{duration:100}),masterEstablishments=s,A=o.length>0?o[0].Postcode:"No results",document.getElementById("rpDisplaySuburb").innerHTML=suburb.fontsize(6)+" Specials - ".fontsize(6)+A,console.log("1. Populate list"),document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+n+"' matching Drink specials";H=document.querySelectorAll("select");if(instances=M.FormSelect.init(H),console.log("State: "+state),initialSearch){var W=suburb;return axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:W,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){lat=e.data.results[0].geometry.location.lat,lng=e.data.results[0].geometry.location.lng,console.log("2. Get suburb coords")}).then(()=>{console.log("3. Start map markers creation");for(var e=0;e<masterEstablishments.length;e++)if(masterEstablishments[e].establishmentSpecials.length>0){console.log("4.1 Start creating a single marker");masterMarkers.push({coords:{lat:masterEstablishments[e].Location.coordinates[1],lng:masterEstablishments[e].Location.coordinates[0]},iconImage:"images/restaurant.png",content:'<a href="establishment.html">'+masterEstablishments[e].Name+"</a><br>"+masterEstablishments[e].Cuisine_Type+"<br>"+masterEstablishments[e].Address,Cuisine_Type:masterEstablishments[e].Cuisine_Type,establishmentSpecials:masterEstablishments[e].establishmentSpecials,objectId:masterEstablishments[e].objectId}),console.log("4.2 Finish creating a single marker")}console.log("5. Finish map markers creation")}).catch(function(e){}).then(()=>{console.log("6. Initialize map")})}}function initMap(){console.log("7. Map Initialization started");var e={zoom:13,center:{lat:lat,lng:lng}};console.log("8. Start print markers"),console.log("9. End print markers");var t,s=new google.maps.Map(document.getElementById("rpGoogleMap"),e);if(console.log("Running first time"),console.log("10. Map created"),console.log("10.1 clear markers"),console.log(useFilteredMarkers),0==useFilteredMarkers)for(var l=0;l<masterMarkers.length;l++)a(masterMarkers[l]);else for(l=0;l<filteredMarkers.length;l++)a(filteredMarkers[l]);function a(e){var l=new google.maps.Marker({position:e.coords,map:s,Cuisine_Type:e.Cusine_Type,establishmentSpecials:e.establishmentSpecials,objectId:e.objectId});if(e.iconImage&&l.setIcon(e.iconImage),e.content){var a=new google.maps.InfoWindow({content:e.content});l.addListener("click",function(){t&&t.close(),a.open(s,l),t=a})}}console.log("11. Markers added")}function setMapOnAll(e){for(var t=0;t<filteredMarkers.length;t++)filteredMarkers[t].setMap(e)}function clearMarkers(){setMapOnAll(null),filteredMarkers=[]}function deleteMarkers(){for(var e=0;e<filteredMarkers.length;e++)filteredMarkers[e].setMap(null);filteredMarkers=[]}function daysOfWeekFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function timePeriodFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function specialCategoryFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function cusineTypeFilter(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",state="filtered-list",console.log("State: "+state),applyFilters()}function establishmentTypeFilter(){state="filtered-list",console.log("State: "+state),applyFilters()}function typeOfSpecialFilterDrink(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!0,$("select").formSelect(),_typeOfSpecial=["Drink"],state="filtered-list",console.log("State: "+state),applyFilters()}function typeOfSpecialFilterFood(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!1,$("select").formSelect(),_typeOfSpecial=["Food"],state="filtered-list",console.log("State: "+state),applyFilters()}function applyFilters(){var e=$("#daysOfWeekFilter").val(),t=$("#timePeriodStartFilter").val(),s=$("#timePeriodEndFilter").val(),l=$("#specialCategoryFilter").val(),a=$("#cusineTypeFilter").val(),i=_typeOfSpecial;console.log(i);for(var n=masterEstablishments,r=[],o=0;o<n.length;o++)for(var c=0;c<n[o].establishmentSpecials.length;c++){var d=[];if(n[o].establishmentSpecials[c].Days_Of_Week.includes(", "))for(var p=n[o].establishmentSpecials[c].Days_Of_Week.split(", "),m=0,b=p.length;m<b;m++)d.push(p[m]);else d.push(n[o].establishmentSpecials[c].Days_Of_Week);for(var g=0;g<e.length;g++)1==d.includes(e[g])&&r.push(n[o].establishmentSpecials[c].objectId)}console.log(r),e.length>=1&&r.length>=0&&(n=n.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>r.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var u=60*t.substring(0,2)+ +t.substring(3,5),h=60*s.substring(0,2)+ +s.substring(3,5),y=[],f=[];for(o=0;o<n.length;o++)for(c=0;c<n[o].establishmentSpecials.length;c++){var S=n[o].establishmentSpecials[c].Start_Time,v=n[o].establishmentSpecials[c].End_Time;S=60*S.substring(0,2)+ +S.substring(3,5),(v=60*v.substring(0,2)+ +v.substring(3,5))>u&&S<h&&(y.push(n[o].establishmentSpecials[c]),f.push(n[o].establishmentSpecials[c].objectId))}if(f.length>=0&&(n=n.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>f.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),l.length>=1&&(n=n.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>l.includes(e.Category));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),"Food"==_typeOfSpecial[0]){var F=[],I=[];for(o=0;o<n.length;o++){var M=[];if(n[o].Cuisine_Type.includes(", ")){var T=n[o].Cuisine_Type.split(", ");for(m=0,b=T.length;m<b;m++)M.push(T[m])}else M.push(n[o].Cuisine_Type);for(g=0;g<a.length;g++)1==M.includes(a[g])&&(I.push(n[o]),F.push(n[o].objectId))}console.log(I),console.log(a),console.log(F),a.length>=1&&(n=n.filter(e=>F.includes(e.objectId)))}i.length>=1&&(n=n.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>i.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var k={},E=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"];for(o=0;o<E.length;o++)k[E[o]]=o;var _=0;if("establishment-page-map"!=state){document.getElementById("rpList").innerHTML="";for(o=0;o<n.length;o++){n[o].establishmentSpecials.sort(function(e,t){return k[e.Category]-k[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),document.getElementById("rpList").innerHTML+='<div class="establishment-wrapper"  data-id="'+n[o].objectId+'" id="viewEstablishmentPage"><img class="rpImage" src="'+n[o].Image+'"><br><b>'+n[o].Name+"</b><br>"+n[o].Cuisine_Type+"<br>"+n[o].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+n[o].objectId+'"></tbody></table></div>';for(c=0;c<n[o].establishmentSpecials.length;c++){var C,B=document.getElementById("myTable"+n[o].objectId);C=n[o].establishmentSpecials[c].Days_Of_Week.split(", ");for(var L="M ",O="T ",j="W ",D="T ",w="F ",A="S ",H="S",W=0;W<C.length;W++)"Monday"==C[W]?L=L.fontcolor("#FF3399"):"Tuesday"==C[W]?O=O.fontcolor("#FF3399"):"Wednesday"==C[W]?j=j.fontcolor("#FF3399"):"Thursday"==C[W]?D=D.fontcolor("#FF3399"):"Friday"==C[W]?w=w.fontcolor("#FF3399"):"Saturday"==C[W]?A=A.fontcolor("#FF3399"):"Sunday"==C[W]&&(H=H.fontcolor("#FF3399"));addRow(B,'<div class="category">'+n[o].establishmentSpecials[c].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(n[o].establishmentSpecials[c].Start_Time)+" - "+tConvert(n[o].establishmentSpecials[c].End_Time)+"</div>",n[o].establishmentSpecials[c].objectId),addRowBottom(B,n[o].establishmentSpecials[c].Description,'<div class="daysAbbreviated">'+L+O+j+D+w+A+H+"</div>",n[o].establishmentSpecials[c].objectId),_++}document.getElementById("rpList").innerHTML+="<br>"}document.getElementById("rpNumOfSpecialsFound").innerHTML="Found '"+_+"' matching "+_typeOfSpecial[0]+" specials"}if("block"==document.getElementById("rpGoogleMap").style.display){if(console.log("Map displayed"),useFilteredMarkers=!0,"establishment-page-map"==state)console.log("State: Display establishment map marker"),filteredMarkers=masterMarkers.filter(e=>e.content.includes(document.getElementById("rpNumOfSpecialsFound").innerHTML));else{filteredMarkers=masterMarkers,console.log(masterEstablishments),console.log(filteredMarkers);var R=[];for(o=0;o<filteredMarkers.length;o++)for(c=0;c<filteredMarkers[o].establishmentSpecials.length;c++){var N=[];if(filteredMarkers[o].establishmentSpecials[c].Days_Of_Week.includes(", ")){var z=filteredMarkers[o].establishmentSpecials[c].Days_Of_Week.split(", ");for(m=0,b=z.length;m<b;m++)N.push(z[m])}else N.push(filteredMarkers[o].establishmentSpecials[c].Days_Of_Week);for(g=0;g<e.length;g++)1==N.includes(e[g])&&R.push(filteredMarkers[o].establishmentSpecials[c].objectId)}console.log(R),e.length>=1&&R.length>=0&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>R.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var P=60*t.substring(0,2)+ +t.substring(3,5),G=60*s.substring(0,2)+ +s.substring(3,5),U=[],q=[];for(o=0;o<filteredMarkers.length;o++)for(c=0;c<filteredMarkers[o].establishmentSpecials.length;c++){var x=filteredMarkers[o].establishmentSpecials[c].Start_Time,X=filteredMarkers[o].establishmentSpecials[c].End_Time;x=60*x.substring(0,2)+ +x.substring(3,5),(X=60*X.substring(0,2)+ +X.substring(3,5))>P&&x<G&&(U.push(filteredMarkers[o].establishmentSpecials[c]),q.push(filteredMarkers[o].establishmentSpecials[c].objectId))}q.length>=0&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>q.includes(e.objectId));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[])),l.length>=1&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>l.includes(e.Category));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]));var J=[],Q=[];for(o=0;o<filteredMarkers.length;o++){var K=[];if(filteredMarkers[o].Cuisine_Type.includes(", ")){var V=filteredMarkers[o].Cuisine_Type.split(", ");for(m=0,b=V.length;m<b;m++)K.push(V[m])}else K.push(filteredMarkers[o].Cuisine_Type);for(g=0;g<a.length;g++)1==K.includes(a[g])&&(Q.push(filteredMarkers[o]),J.push(filteredMarkers[o].objectId))}console.log(Q),console.log(a),console.log(J),a.length>=1&&(filteredMarkers=filteredMarkers.filter(e=>J.includes(e.objectId))),i.length>=1&&(filteredMarkers=filteredMarkers.reduce((e,t)=>{const s=t.establishmentSpecials.filter(e=>i.includes(e.Type_Of_Special));return s.length>0?[...e,{...t,establishmentSpecials:s}]:e},[]))}initMap()}}function btnShowList(){document.getElementById("rpGoogleMap").style.display="none",document.getElementById("rpList").style.display="block",document.getElementById("cusineTypeFilter").disabled=!1,$("select").formSelect(),"establishment-page-map"==state?(state="establishment-page",console.log("State: "+state)):"establishment-page"==state?(state="filtered-list",console.log("State: "+state),applyFilters()):(state="filtered-list")&&console.log("State: "+state)}function btnShowMap(){document.getElementById("rpList").style.display="none",document.getElementById("rpGoogleMap").style.display="block","filtered-list"==state&&(state="filtered-list-map",console.log("State: "+state)),"establishment-page"==state&&(state="establishment-page-map",console.log("State: "+state)),applyFilters()}function onlyUnique(e,t,s){return s.indexOf(e)===t}function addCellTop(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.colSpan=2,l.classList.add("cellTopCSS"),e.appendChild(l)}function addCell(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.classList.add("cellCSS"),e.appendChild(l)}function addCellBottom(e,t,s){var l=document.createElement("td");l.innerHTML=t,l.classList.add("cellBottomCSS"),e.appendChild(l)}function addRowTop(e,t,s){var l=document.createElement("tr");l.id=s,addCellTop(l,t),e.appendChild(l)}function addRow(e,t,s,l){var a=document.createElement("tr");a.id=l,addCell(a,t),addCell(a,s),e.appendChild(a)}function addRowBottom(e,t,s,l){var a=document.createElement("tr");a.id=l,addCellBottom(a,t),addCellBottom(a,s),e.appendChild(a)}function research(){initialSearch=!1,suburb=document.getElementById("rpReSearchInputDiv").value,localStorage.setItem("usersSuburb",suburb),masterEstablishments=[],masterMarkers=[],pageOnLoad()}function tConvert(e){return(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).length>1&&((e=e.slice(1))[5]=+e[0]<12?" AM":" PM",e[0]=+e[0]%12||12),e.join("")}function testing(){console.log(filteredMarkers),setMapOnAll(null)}function setMapOnAll(e){for(var t=0;t<filteredMarkers.length;t++)console.log(filteredMarkers[t].coords.lat),filteredMarkers.setMap(e)}document.addEventListener("DOMContentLoaded",function(){pageOnLoad()}),$(document).on("click","#viewEstablishmentPage",function(){var e=$(this).attr("data-id");console.log(masterEstablishments);for(var t=document.getElementById("myTable"+e),s=0,l=masterEstablishments.length;s<l;s++)if(e==masterEstablishments[s].objectId){document.getElementById("rpList").innerHTML='<div class="establishment-wrapper"><img class="rpImage" src="'+masterEstablishments[s].Image+'"><br><b>'+masterEstablishments[s].Name+"</b><br>"+masterEstablishments[s].Cuisine_Type+"<br>"+masterEstablishments[s].objectId+"<br>"+masterEstablishments[s].Address+"<br><br></div>",document.getElementById("rpList").innerHTML+='<div class="tbl-wrapper" ><table id=\'tbl\' class="striped"><colgroup><col span="1" class="tbl-special"><col span="1" class="tbl-days"></colgroup><thead><tr><th class="tbl-special-th">Special</th><th class="tbl-days-th">Days</th></tr></thead><tbody id="myTable'+s+'"></tbody></table></div>';for(var a=[],i=0,n=t.rows.length;i<n;i++)a.push(t.rows[i].id),i++;console.log("Object IDs:"),console.log(a);var r=[],o=masterEstablishments[s];console.log("Establishment"),console.log(o);var c=[],d=0,p=o.establishmentSpecials.length;console.log("Establishment's number of specials: "+p);for(d=0;d<p;d++)c.push(o.establishmentSpecials[d]);console.log("Establishment's specials: "),console.log(c);for(var m=c,b=c,g={},u=["Breakfast Special","Lunch Special","Dinner Special","Happy Hour"],h=0;h<u.length;h++)g[u[h]]=h;var y=[];(y=m.filter(e=>!a.includes(e.objectId))).sort(function(e,t){return g[e.Category]-g[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),console.log("Sorted - Other establishment specials: "),console.log(y),(r=b.filter(e=>a.includes(e.objectId))).sort(function(e,t){return g[e.Category]-g[t.Category]||e.Start_Time.localeCompare(t.Start_Time)}),console.log("Sorted - establishment specials"),console.log(r);for(var f=0,S=y.length;f<S;f++)y[f].otherSpecials=void 0;y.length>0&&(y[0].otherSpecials="yes"),console.log("otherSpecials = undefined"),console.log(y);var v=[];v=r.concat(y);console.log(v);for(var F=0;F<v.length;F++){var I,M=document.getElementById("myTable"+s);I=v[F].Days_Of_Week.split(", ");for(var T="M ",k="T ",E="W ",_="T ",C="F ",B="S ",L="S",O=0;O<I.length;O++)"Monday"==I[O]?T=T.fontcolor("#FF3399"):"Tuesday"==I[O]?k=k.fontcolor("#FF3399"):"Wednesday"==I[O]?E=E.fontcolor("#FF3399"):"Thursday"==I[O]?_=_.fontcolor("#FF3399"):"Friday"==I[O]?C=C.fontcolor("#FF3399"):"Saturday"==I[O]?B=B.fontcolor("#FF3399"):"Sunday"==I[O]&&(L=L.fontcolor("#FF3399"));0==F?(addRowTop(M,"Specials matching your search criteria",v[F].objectId),addRow(M,'<div class="category">'+v[F].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[F].Start_Time)+" - "+tConvert(v[F].End_Time)+"</div>",v[F].objectId),addRowBottom(M,v[F].Description,'<div class="daysAbbreviated">'+T+k+E+_+C+B+L+"</div>",v[F].objectId)):"yes"==v[F].otherSpecials?(console.log(v[F].Description),addRowTop(M,"Other specials on offer",v[F].objectId),addRow(M,'<div class="category">'+v[F].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[F].Start_Time)+" - "+tConvert(v[F].End_Time)+"</div>",v[F].objectId),addRowBottom(M,v[F].Description,'<div class="daysAbbreviated">'+T+k+E+_+C+B+L+"</div>",v[F].objectId)):(addRow(M,'<div class="category">'+v[F].Category.replace("Special","")+"</div>",'<div class="time-period">'+tConvert(v[F].Start_Time)+" - "+tConvert(v[F].End_Time)+"</div>",v[F].objectId),addRowBottom(M,v[F].Description,'<div class="daysAbbreviated">'+T+k+E+_+C+B+L+"</div>",v[F].objectId))}document.getElementById("rpNumOfSpecialsFound").innerHTML=masterEstablishments[s].Name}state="establishment-page",console.log("State: "+state)});