Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C");var cellID,masterEstablishmentsAustralia=[],masterEstablishmentsNewZealand=[],Australia=!0;function onPageLoadTable(){console.log("OnPageLoadTable called"),$("#myTable tr").remove(),tbl=document.getElementById("myTable");var e=Backendless.DataQueryBuilder.create();e.setRelated(["establishmentSpecials"]),1==Australia?e.setWhereClause("Country = 'Australia'"):e.setWhereClause("Country = 'New Zealand'"),Backendless.Data.of("Establishment").find(e).then(function(e){console.log(e);for(var t=0;t<e.length;t++)addRow(tbl,e[t].Name,e[t].Address,e[t].objectId,e[t].objectId);return addRowHandlers(),console.log("3. Returning masterEstablishmentsAustralia next line"),masterEstablishmentsAustralia=e}).catch(function(e){}).then(()=>{console.log("4. Calling displaySpecials() inside onPageLoadTable()"),displaySpecials()}),$("#myInput").on("keyup",function(){var e=$(this).val().toLowerCase();$("#myTable tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}),document.querySelector("tbody").addEventListener("click",function(e){var t=e.target.closest("tr"),n=e.currentTarget.querySelector("tr.selected");t.classList.add("selected"),n&&n.classList.remove("selected")})}function onPageLoad(){var e=document.getElementById("establishmentListBox"),t=0,n=Backendless.DataQueryBuilder.create();n.setWhereClause("Country = 'Australia'"),Backendless.Data.of("Establishment").find(n).then(function(n){console.log(n);for(var a=0;a<n.length;a++)e.options[t]=new Option(n[a].Name+" | "+n[a].Address,n[a].objectId),t++;masterEstablishmentsAustralia=n}).catch(function(e){})}function addCell(e,t,n){var a=document.createElement("td");a.id=n,a.innerHTML=t,e.appendChild(a)}function addRow(e,t,n,a,s){var l=document.createElement("tr");addCell(l,t,a),addCell(l,n,s),e.appendChild(l)}function addRowHandlers(){var e=document.getElementById("tbl"),t=e.getElementsByTagName("tr");for(i=0;i<t.length;i++){var n=e.rows[i];n.onclick=function(e){return function(){var t=e.getElementsByTagName("td")[0].id;cellID=t,displaySpecials()}}(n)}}function checkBoxAddToEstablishmentFunc(){""==document.getElementById("establishmentId").value?(alert("You need to select a valid establishment"),document.getElementById("chkBoxAddToEstablishment").checked=!1):1==document.getElementById("chkBoxAddToEstablishment").checked?(document.getElementById("or").style.display="none",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Adding special to "+document.getElementById("name").value+"</h5>",document.getElementById("add_name").value=document.getElementById("name").value,document.getElementById("add_name").disabled=!0,document.getElementById("add_address").value=document.getElementById("address").value,document.getElementById("add_address").disabled=!0,document.getElementById("add_suburb").value=document.getElementById("suburb").value,document.getElementById("add_suburb").disabled=!0,"Establishments - Australia"==document.getElementById("headingLstBoxEstablishments").innerHTML?(document.getElementById("add_country").value="Australia",document.getElementById("add_country").disabled=!0):(document.getElementById("add_country").value="New Zealand",document.getElementById("add_country").disabled=!0),document.getElementById("add_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("add_establishment_type").disabled=!0,document.getElementById("add_cusine_type").value=document.getElementById("cusineType").value,document.getElementById("add_cusine_type").disabled=!0,document.getElementById("skipSpecial").style.display="none",$("select").formSelect(),M.updateTextFields()):(document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",document.getElementById("add_name").value="",document.getElementById("add_name").disabled=!1,document.getElementById("add_address").value="",document.getElementById("add_address").disabled=!1,document.getElementById("add_suburb").value="",document.getElementById("add_suburb").disabled=!1,document.getElementById("add_country").value="",document.getElementById("add_country").disabled=!1,document.getElementById("add_establishment_type").value="",document.getElementById("add_establishment_type").disabled=!1,document.getElementById("add_cusine_type").value="",document.getElementById("add_cusine_type").disabled=!1,document.getElementById("skipSpecial").style.display="block",$("select").formSelect(),M.updateTextFields())}function removeOptions(e){var t;for(t=e.options.length-1;t>=0;t--)e.remove(t)}function removeLastOption(e){e.length>0&&e.remove(e.length-1)}function displaySpecials(){document.getElementById("formSpecialDetails").style.display="none",document.getElementById("formEstablishmentDetails").style.display="block";var e=document.getElementById("establishmentId"),t=document.getElementById("name"),n=document.getElementById("address"),a=document.getElementById("suburb"),s=document.getElementById("country"),l=document.getElementById("establishmentType"),d=document.getElementById("cusineType"),o=document.getElementById("image"),i=document.getElementById("image-file-name");/[^\/]*$/.exec("foo/bar/test.html")[0];document.getElementById("formHeading").innerHTML="Establishment details";document.getElementById("establishmentListBox");for(var m=cellID,r=0;r<masterEstablishmentsAustralia.length;r++)masterEstablishmentsAustralia[r].objectId==m&&(e.value=masterEstablishmentsAustralia[r].objectId,t.value=masterEstablishmentsAustralia[r].Name,n.value=masterEstablishmentsAustralia[r].Address,a.value=masterEstablishmentsAustralia[r].Suburb,s.value=masterEstablishmentsAustralia[r].Country,l.value=masterEstablishmentsAustralia[r].Establishment_Type,d.value=masterEstablishmentsAustralia[r].Cuisine_Type,o.src=masterEstablishmentsAustralia[r].Image,i.innerHTML=/[^\/]*$/.exec(masterEstablishmentsAustralia[r].Image)[0]);var c,u=document.getElementById("specialListBox");removeOptions(u);for(r=0;r<masterEstablishmentsAustralia.length;r++)if(m==masterEstablishmentsAustralia[r].objectId){c=r;for(var g=0;g<masterEstablishmentsAustralia[c].establishmentSpecials.length;g++)u.options[g]=new Option(masterEstablishmentsAustralia[c].establishmentSpecials[g].Category+" | "+masterEstablishmentsAustralia[c].establishmentSpecials[g].Type_Of_Special,masterEstablishmentsAustralia[c].objectId);break}M.updateTextFields()}function getSpecial(){try{document.getElementById("formEstablishmentDetails").style.display="none",document.getElementById("formSpecialDetails").style.display="block",document.getElementById("formHeading").innerHTML="Special details";for(var e=document.getElementById("specialListBox"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].index,a=0;a<masterEstablishmentsAustralia.length;a++)if(t==masterEstablishmentsAustralia[a].objectId){document.getElementById("establishmentIdSpecial").value=masterEstablishmentsAustralia[a].objectId,document.getElementById("specialId").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].objectId;var s=masterEstablishmentsAustralia[a].establishmentSpecials[n].Days_Of_Week.replace(/,/g,", ");if(document.getElementById("daysOfWeek").value=s,document.getElementById("startTime").value=tConvert(masterEstablishmentsAustralia[a].establishmentSpecials[n].Start_Time),document.getElementById("endTime").value=tConvert(masterEstablishmentsAustralia[a].establishmentSpecials[n].End_Time),document.getElementById("category").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Category,document.getElementById("typeOfSpecial").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Type_Of_Special,document.getElementById("descriptionFullText").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description,masterEstablishmentsAustralia[a].establishmentSpecials[n].Description.length>125){var l=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description;document.getElementById("description").value=l.substring(0,121)+" ...",$("#tooltip").attr("data-tooltip",masterEstablishmentsAustralia[a].establishmentSpecials[n].Description),$(".material-tooltip").css({display:"block"})}else if(masterEstablishmentsAustralia[a].establishmentSpecials[n].Description.length<=125){document.getElementById("description").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description,$("#tooltip").attr("data-tooltip","Less than 120"),$(".material-tooltip").css({display:"none"})}break}M.textareaAutoResize($("#description")),M.updateTextFields()}catch(e){console.log(e),document.getElementById("specialId").value="",document.getElementById("daysOfWeek").value="",document.getElementById("startTime").value="",document.getElementById("endTime").value="",document.getElementById("category").value="",document.getElementById("typeOfSpecial").value="",document.getElementById("description").value="",$(".material-tooltip").css({display:"none"})}}function displayAus(){"Establishments - Australia"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!0,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - Australia")}function displayNZ(){"Establishments - New Zealand"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!1,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - New Zealand")}function toastNotification(e,t,n,a,s,l){M.toast({html:'<div class="toast-side"></div><div class="toast-notification-con"><img class="'+t+'" src="images/'+n+'"><div class="toast-message">'+e+'</div><img class="toast-close" src="images/toast-close.png" height="16" width="16"></div>',displayLength:s,classes:""+a}),$(".toast-side").css({"background-color":l}),$(document).on("click",".toast-close",function(){$("#toast-container .toast").fadeOut(500,function(){$("#toast-container .toast").remove()})})}function enableEstablishmentDetails(){document.getElementById("add_name").disabled=!1,document.getElementById("add_address").disabled=!1,document.getElementById("add_suburb").disabled=!1,document.getElementById("add_country").disabled=!1,document.getElementById("add_establishment_type").disabled=!1,document.getElementById("add_cusine_type").disabled=!1,$("select").formSelect()}function tConvert(e){return(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).length>1&&((e=e.slice(1))[5]=+e[0]<12?" AM":" PM",e[0]=+e[0]%12||12),e.join("")}function convertTo24Hour2(e){time=document.getElementById(e).value;var t=Number(time.match(/^(\d+)/)[1]),n=Number(time.match(/:(\d+)/)[1]),a=time.match(/\s(.*)$/)[1];"PM"==a&&t<12&&(t+=12),"AM"==a&&12==t&&(t-=12);var s=t.toString(),l=n.toString();return t<10&&(s="0"+s),n<10&&(l="0"+l),s+":"+l}$(document).ready(function(){onPageLoadTable(),$(".tabs").tabs(),$("select").formSelect(),$(".modal").modal(),$("input.autocomplete").autocomplete({data:{"Sushi Bar Rose Bay":"FE497F9F-3300-F248-FFF0-87FBF48BBC00","734 New South Head Rd":"FE497F9F-3300-F248-FFF0-87FBF48BBC00","Jewel on the Bay":"87FFFAD6-C7EE-9094-FF6E-5CF6AF213C00","639 New South Head Rd":"87FFFAD6-C7EE-9094-FF6E-5CF6AF213C00",Google:"https://placehold.it/250x250"}}),$("input#input_text, textarea#add_description").characterCounter(),$("input#input_text, textarea#update_description").characterCounter(),M.textareaAutoResize($("#description")),$(".modal-add").modal({startingTop:"4%"}),$(".timepicker").timepicker(),$(".tooltipped").tooltip(),$(".materialboxed").materialbox()}),addBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll();var t=document.getElementById("name").value+" | "+document.getElementById("address").value;" | "==t&&(t="Please select an existing establishment."),document.getElementById("addToExistingEstablishment").value=t,document.getElementById("addToExistingEstablishment").name=document.getElementById("establishmentId").value}),addConfirmBtn.addEventListener("click",e=>{if(console.log("add button clicked"),0==document.getElementById("chkBoxAddToEstablishment").checked){console.log("Create new establishment and special concurrently");var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_country").value,a=document.getElementById("add_establishment_type").value,s=document.getElementById("add_cusine_type").value,l=document.getElementById("filesText").value.trim(),d=document.getElementById("add_address").value.trim(),o=document.getElementById("add_suburb").value.trim(),i=$("#add_days_of_the_week").val().join(),m=document.getElementById("add_start_time").value,r=document.getElementById("add_end_time").value,c=document.getElementById("add_category").value,u=document.getElementById("add_type_of_special").value,g=document.getElementById("add_description").value.trim();if(""==t||t.length>50||""==d||d.length>50||""!=d&&!d.match(/^[a-zA-Z0-9\/\- ]+$/)||""==o||o.length>50||""!=o&&!o.match(/^[A-Za-z ]+$/)||""==n||""==a||""==s||""==l||""==i||""==m||""==r||""==c||""==u||""==g||g.length>500){var y="";""==t&&(y+='"Name" is required!<br>'),t.length>50&&(y+='"Name" must be less than 50 characters!<br>'),""==d&&(y+='"Address" is required!<br>'),d.length>50&&(y+='"Address" must be less than 50 characters!<br>'),""==d||d.match(/^[a-zA-Z0-9\/\- ]+$/)||(y+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==o&&(y+='"Suburb" is required!<br>'),o.length>50&&(y+='"Suburb" must be less than 50 characters!<br>'),""==o||o.match(/^[A-Za-z ]+$/)||(y+='"Suburb" contains non-alphabetic characters!<br>'),""==n&&(y+='"Country" is required!<br>'),""==a&&(y+='"Establishment Type" is required!<br>'),""==s&&(y+='"Cuisine Type" is required!<br>'),""==l&&(y+='"Image" is required!<br>'),""==i&&(y+='"Days of the week" is required!<br>'),""==m&&(y+='"Start time" is required!<br>'),""==r&&(y+='"End time" is required!<br>'),""==c&&(y+='"Category" is required!<br>'),""==u&&(y+='"Type of special" is required!<br>'),""==g&&(y+='"Description" is required!<br>'),g.length>500&&(y+='"Description" must be less than 500 characters!<br>'),toastNotification(y,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),e.preventDefault()}else{var h;document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var p,b,E=d+" "+o,I=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:E,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return p=e.data.results[0].geometry.location.lat,b=e.data.results[0].geometry.location.lng,console.log(p+" : "+b),I.push(p),I.push(b),I}).then(()=>(file=document.getElementById("files").files[0],console.log(document.getElementById("files").files[0].name),Backendless.Files.upload(file,"images").then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),h=e.fileURL}).catch(function(e){"Error: Unable to upload the file: file already exists"==e&&(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"),console.log(e)}))).then(()=>{Promise.all([(()=>{console.log(I),console.log(I[0]),console.log(I[1]);var e={Image:h,Location:(new Backendless.Data.Point).setLatitude(I[0]).setLongitude(I[1]),Name:t,Address:d,Suburb:o,Country:n,Cuisine_Type:s,Establishment_Type:a};return Backendless.Data.of("Establishment").save(e).then(e=>e.objectId)})(),(()=>{var e={Days_Of_Week:i,Start_Time:m,End_Time:r,Category:c,Type_Of_Special:u,Description:g};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)})()]).then(([e,t])=>{console.log(e),console.log(t);var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){console.log("relation has been set"),console.log("1. Finished creating establishment and special concurrently")})}).then(()=>{console.log("Data Successfully Written")}).then(()=>{console.log("2. loading onPageLoadTable() from inside .then() "),onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment and Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{M.updateTextFields()}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none",console.error(e)),"Error: Field 'Image' doesn't have a default value"==e?(document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"):(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"),console.error(e)})})}}else if(1==document.getElementById("chkBoxAddToEstablishment").checked){console.log("Add special to existing establishment");i=$("#add_days_of_the_week").val().join(),m=document.getElementById("add_start_time").value,r=document.getElementById("add_end_time").value,c=document.getElementById("add_category").value,u=document.getElementById("add_type_of_special").value,g=document.getElementById("add_description").value.trim();if(""==i||""==m||""==r||""==c||""==u||""==g||g.length>500){y="";""==i&&(y+='"Days of the week" is required!<br>'),""==m&&(y+='"Start time" is required!<br>'),""==r&&(y+='"End time" is required!<br>'),""==c&&(y+='"Category" is required!<br>'),""==u&&(y+='"Type of special" is required!<br>'),""==g&&(y+='"Description" is required!<br>'),g.length>500&&(y+='"Description" must be less than 500 characters!<br>'),toastNotification(y,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")}else{document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";const e=()=>document.getElementById("addToExistingEstablishment").name,t=()=>{var e={Days_Of_Week:i,Start_Time:m,End_Time:r,Category:c,Type_Of_Special:u,Description:g};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)};Promise.all([e(),t()]).then(([e,t])=>{console.log(e),console.log(t);var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){console.log("relation has been set")}).catch(function(e){console.log("server reported an error - "+e.message)})}).then(()=>{console.log("Data Successfully Written")}).then(()=>{onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{enableEstablishmentDetails()}).then(()=>{document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",document.getElementById("skipSpecial").style.display="block"}).then(()=>{M.updateTextFields()}).catch(e=>{console.error(e)})}}}),addCancelBtn.addEventListener("click",e=>{e.preventDefault(),document.getElementById("addCancelBtn").setAttribute("href","#"),console.log(document.getElementById("addCancelBtn").getAttribute("href"));var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_country").value,a=document.getElementById("add_establishment_type").value,s=document.getElementById("add_cusine_type").value,l=document.getElementById("add_address").value.trim(),d=document.getElementById("add_suburb").value.trim(),o=$("#add_days_of_the_week").val().join(),i=document.getElementById("add_start_time").value,m=document.getElementById("add_end_time").value,r=document.getElementById("add_category").value,c=document.getElementById("add_type_of_special").value,u=document.getElementById("add_description").value.trim(),g=!0;""==t&&""==n&&""==a&&""==s&&""==l&&""==d&&""==o&&""==i&&""==m&&""==r&&""==c&&""==u&&(g=!1),0==g?$("#modal1").modal("close"):1==g&&(document.getElementById("addCancelBtn").setAttribute("href","#modalAddCancelConfirm"),console.log(document.getElementById("addCancelBtn").getAttribute("href")))}),addCancelConfirmDiscardBtn.addEventListener("click",e=>{console.log("discard"),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset(),document.getElementById("add_name").disabled=!1,document.getElementById("add_address").disabled=!1,document.getElementById("add_suburb").disabled=!1,document.getElementById("add_country").disabled=!1,document.getElementById("add_establishment_type").disabled=!1,document.getElementById("add_cusine_type").disabled=!1,document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",$("select").formSelect(),$("#modal1").modal("close"),$("#modalAddCancelConfirm").modal("close"),$("input#input_text, textarea#add_description").characterCounter()}),addSkipSpecialBtn.addEventListener("click",e=>{e.preventDefault();var t=document.getElementById("add_address").value.trim(),n=document.getElementById("add_suburb").value.trim(),a=document.getElementById("add_name").value.trim(),s=document.getElementById("add_country").value,l=document.getElementById("add_establishment_type").value,d=document.getElementById("add_cusine_type").value;if(""==a||a.length>50||""==t.trim()||t.length>50||""!=t&&!t.match(/^[a-zA-Z0-9\/\- ]+$/)||""==n||n.length>50||""!=n&&!n.match(/^[A-Za-z ]+$/)||""==s||""==l||""==d){var o="";""==a&&(o+='"Name" is required!<br>'),a.length>50&&(o+='"Name" must be less than 50 characters!<br>'),""==t&&(o+='"Address" is required!<br>'),t.length>50&&(o+='"Address" must be less than 50 characters!<br>'),""==t||t.match(/^[a-zA-Z0-9\/\- ]+$/)||(o+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==n&&(o+='"Suburb" is required!<br>'),n.length>50&&(o+='"Suburb" must be less than 50 characters!<br>'),""==n||n.match(/^[A-Za-z ]+$/)||(o+='"Suburb" contains non-alphabetic characters!<br>'),""==s&&(o+='"Country" is required!<br>'),""==l&&(o+='"Establishment Type" is required!<br>'),""==d&&(o+='"Cuisine Type" is required!<br>'),toastNotification(o,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")}else{var i;document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var m,r,c=t+" "+n,u=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:c,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return m=e.data.results[0].geometry.location.lat,r=e.data.results[0].geometry.location.lng,console.log(m+" : "+r),u.push(m),u.push(r),u}).then(()=>(file=document.getElementById("files").files[0],console.log(document.getElementById("files").files[0].name),Backendless.Files.upload(file,"images").then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),i=e.fileURL}))).then(()=>{var e={Image:i,Location:(new Backendless.Data.Point).setLatitude(u[0]).setLongitude(u[1]),Name:a,Address:t,Suburb:n,Country:s,Cuisine_Type:d,Establishment_Type:l};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("new establishment instance alone has been saved"),cellID=e.objectId,console.log(e),$("#debugImage").attr("src",e.Image)})}).then(()=>{console.log("Data Successfully Written")}).then(()=>{onPageLoadTable()}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{M.updateTextFields()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none",console.error(e)),"Error: Unable to upload the file: file already exists"==e?(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"):(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"),console.error(e)})}}),updateBtn.addEventListener("click",e=>{if(e.preventDefault(),M.Toast.dismissAll(),""==document.getElementById("establishmentId").value)document.getElementById("updateBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548");else if("Establishment details"==document.getElementById("formHeading").innerHTML)document.getElementById("updateBtn").setAttribute("href","#modal2"),console.log("updating establishment details"),document.getElementById("formUpdateSpecialDetails").style.display="none",document.getElementById("formUpdateEstablishmentDetails").style.display="block",document.getElementById("updateHeading").innerHTML="Update establishment",document.getElementById("update_establishmentId").value=document.getElementById("establishmentId").value,document.getElementById("update_name").value=document.getElementById("name").value,document.getElementById("update_address").value=document.getElementById("address").value,document.getElementById("update_suburb").value=document.getElementById("suburb").value,document.getElementById("update_country").value=document.getElementById("country").value,document.getElementById("update_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("update_cusine_type").value=document.getElementById("cusineType").value,document.getElementById("update-image-file-name").innerHTML=document.getElementById("image-file-name").innerHTML,document.getElementById("updateimage").src=document.getElementById("image").src;else if("Special details"==document.getElementById("formHeading").innerHTML)if(""==document.getElementById("specialId").value)console.log("In special"),document.getElementById("updateBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548");else{document.getElementById("updateBtn").setAttribute("href","#modal2"),M.textareaAutoResize($("#update_description")),document.getElementById("updateHeading").innerHTML="Update special",document.getElementById("formUpdateEstablishmentDetails").style.display="none",document.getElementById("formUpdateSpecialDetails").style.display="block";var t=document.getElementById("daysOfWeek").value.split(", ");$("#update_days_of_the_week").val(t),document.getElementById("update_start_time").value=convertTo24Hour2("startTime"),document.getElementById("update_end_time").value=convertTo24Hour2("endTime"),document.getElementById("update_category").value=document.getElementById("category").value,document.getElementById("update_type_of_special").value=document.getElementById("typeOfSpecial").value,document.getElementById("update_description").value=document.getElementById("descriptionFullText").value,console.log("hi"),console.log(document.getElementById("descriptionFullText").value),M.textareaAutoResize($("#update_description"))}$("select").formSelect(),M.updateTextFields()}),updateConfirmBtn.addEventListener("click",e=>{e.preventDefault();document.getElementById("establishmentId").value;if("Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("establishmentId").value.trim(),n=document.getElementById("update_name").value.trim(),a=document.getElementById("update_address").value.trim(),s=document.getElementById("update_suburb").value.trim(),l=document.getElementById("update_country").value,d=document.getElementById("update_establishment_type").value,o=document.getElementById("update_cusine_type").value;if(""==n||n.length>50||""==a||a.length>50||""!=a&&!a.match(/^[a-zA-Z0-9\/\- ]+$/)||""==s||s.length>50||""!=s&&!s.match(/^[A-Za-z ]+$/)||""==l||""==d||""==o){var i="";""==n&&(i+='"Name" is required!<br>'),n.length>50&&(i+='"Name" must be less than 50 characters!<br>'),""==a&&(i+='"Address" is required!<br>'),a.length>50&&(i+='"Address" must be less than 50 characters!<br>'),""==a||a.match(/^[a-zA-Z0-9\/\- ]+$/)||(i+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==s&&(i+='"Suburb" is required!<br>'),s.length>50&&(i+='"Suburb" must be less than 50 characters!<br>'),""==s||s.match(/^[A-Za-z ]+$/)||(i+='"Suburb" contains non-alphabetic characters!<br>'),""==l&&(i+='"Country" is required!<br>'),""==d&&(i+='"Establishment Type" is required!<br>'),""==o&&(i+='"Cuisine Type" is required!<br>'),toastNotification(i,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),e.preventDefault()}else{document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block";if(document.getElementById("address").value==a&&document.getElementById("suburb").value==s||""==document.getElementById("updateFiles").value)if(document.getElementById("address").value!=a||document.getElementById("suburb").value!=s){console.log("Address changed");g=a+" "+s,y=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:g,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return c=e.data.results[0].geometry.location.lat,u=e.data.results[0].geometry.location.lng,console.log(c+" : "+u),y.push(c),y.push(u),y}).then(()=>{var e={Location:(new Backendless.Data.Point).setLatitude(y[0]).setLongitude(y[1]),objectId:t,Name:n,Address:a,Suburb:s,Country:l,Establishment_Type:d,Cuisine_Type:o};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)})}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b")}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none",console.error(e))})}else{if(""!=document.getElementById("updateFiles").value)return console.log("File changed"),file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),r=e.fileURL}).then(()=>{var e={Image:r,objectId:t,Name:n,Address:a,Suburb:s,Country:l,Establishment_Type:d,Cuisine_Type:o};return cellID=t,Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)})}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b")}).catch(e=>{console.error(e)});if(document.getElementById("name").value!=document.getElementById("update_name").value||document.getElementById("country").value!=document.getElementById("update_country").value||document.getElementById("establishmentType").value!=document.getElementById("update_establishment_type").value||document.getElementById("cusineType").value!=document.getElementById("update_cusine_type").value){console.log("Non file or address changed");var m={objectId:t,Name:n,Address:a,Suburb:s,Country:l,Establishment_Type:d,Cuisine_Type:o};return Backendless.Data.of("Establishment").save(m).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b")}).then(()=>{}).catch(e=>{console.error(e)})}}else{var r;console.log("Address and file changed");var c,u,g=a+" "+s,y=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:g,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return c=e.data.results[0].geometry.location.lat,u=e.data.results[0].geometry.location.lng,console.log(c+" : "+u),y.push(c),y.push(u),y}).then(()=>(file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),r=e.fileURL}))).then(()=>{var e={Image:r,Location:(new Backendless.Data.Point).setLatitude(y[0]).setLongitude(y[1]),objectId:t,Name:n,Address:a,Suburb:s,Country:l,Establishment_Type:d,Cuisine_Type:o};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)})}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b")}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548"),document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none",console.error(e))})}}}else if("Special details"==document.getElementById("formHeading").innerHTML){var h=document.getElementById("specialId").value,p=$("#update_days_of_the_week").val().join(),b=document.getElementById("update_start_time").value,E=document.getElementById("update_end_time").value,I=document.getElementById("update_category").value,B=document.getElementById("update_type_of_special").value,f=document.getElementById("update_description").value;if(!(""==p||""==b||""==E||""==I||""==B||""==f||f.length>500)){document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block";var v={objectId:h,Days_Of_Week:p,Start_Time:b,End_Time:E,Category:I,Type_Of_Special:B,Description:f};return Backendless.Data.of("Special").save(v).then(function(e){console.log("Special instance has been updated")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Special has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b")}).then(()=>{document.getElementById("startTime").value=tConvert(document.getElementById("update_start_time").value),document.getElementById("endTime").value=tConvert(document.getElementById("update_end_time").value),document.getElementById("category").value=document.getElementById("update_category").value,document.getElementById("typeOfSpecial").value=document.getElementById("update_type_of_special").value,document.getElementById("description").value=document.getElementById("update_description").value}).catch(e=>{console.error(e)})}i="";""==p&&(i+='"Days of the week" is required!<br>'),""==b&&(i+='"Start time" is required!<br>'),""==E&&(i+='"End time" is required!<br>'),""==I&&(i+='"Category" is required!<br>'),""==B&&(i+='"Type of special" is required!<br>'),""==f&&(i+='"Description" is required!<br>'),f.length>500&&(i+='"Description" must be less than 500 characters!<br>'),toastNotification(i,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")}}),updateCancelBtn.addEventListener("click",e=>{e.preventDefault(),updateForm=document.querySelector("#updatespecial-form"),updateForm.reset()}),deleteBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),""==document.getElementById("establishmentId").value?(document.getElementById("deleteBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")):"Establishment details"==document.getElementById("formHeading").innerHTML?(document.getElementById("deleteBtn").setAttribute("href","#modalDeleteCancelConfirm"),document.getElementById("establishmentToDelete").innerHTML=document.getElementById("name").value,document.getElementById("deleteConfirmHeading").innerHTML="Are you sure you want to delete the establishment?"):"Special details"==document.getElementById("formHeading").innerHTML&&(""==document.getElementById("specialId").value?(console.log("In special"),document.getElementById("deleteBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")):(document.getElementById("deleteBtn").setAttribute("href","#modalDeleteCancelConfirm"),document.getElementById("establishmentToDelete").innerHTML=document.getElementById("name").value,document.getElementById("deleteConfirmHeading").innerHTML="Are you sure you want to delete the "+document.getElementById("category").value+"?"))}),deleteCancelConfirmDeleteBtn.addEventListener("click",e=>{if(e.preventDefault(),"Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("establishmentId").value;console.log(t);for(var n=0;n<masterEstablishmentsAustralia.length;n++)if(masterEstablishmentsAustralia[n].objectId==t){if(!(masterEstablishmentsAustralia[n].establishmentSpecials.length>0)){document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Deleting",document.getElementById("h5workingAnimMessage").style.display="block";var a=/[^\/]*$/.exec(masterEstablishmentsAustralia[n].Image)[0];return Backendless.Files.remove("images/"+a).then(function(){console.log("file has been deleted")}).catch(function(e){console.log("error - "+e.message)}),Backendless.Data.of("Establishment").remove({objectId:t}).then(function(e){console.log("Establishment instance has been deleted")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{onPageLoadTable()}).then(()=>{$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("addToExistingEstablishment").value="",console.log(document.getElementById("addToExistingEstablishment").value),document.getElementById("image-file-name").innerHTML="",$("#image").removeAttr("src")}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).catch(e=>{console.error(e)})}toastNotification("The establishment must contain no specials in order to delete.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548")}}else if("Special details"==document.getElementById("formHeading").innerHTML){var s=document.getElementById("specialId").value;return Backendless.Data.of("Special").remove({objectId:s}).then(function(e){console.log("Special instance has been deleted")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{$("#specialListBox option:selected").remove(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset()}).then(()=>{onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Special has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd")}).catch(e=>{console.error(e)})}console.log("confirm deletion")});