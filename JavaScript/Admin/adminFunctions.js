Backendless.serverURL="https://api.backendless.com",Backendless.initApp("073669A8-CCB7-2AED-FFEC-841A4CE5F400","FAFDE171-5308-49CF-9980-AA89E4F28F0C");var cellID,masterEstablishmentsAustralia=[],masterEstablishmentsNewZealand=[],Australia=!0;function logoutUser(){localStorage.setItem("userStatus","logged_out"),console.log("logged_out"),window.location.href="../admin.html"}function onPageLoadTable(){$("#myTable tr").remove();var e=document.getElementById("myTable"),t=Backendless.DataQueryBuilder.create();t.setRelated(["establishmentSpecials"]),1==Australia?t.setWhereClause("Country = 'Australia'"):t.setWhereClause("Country = 'New Zealand'"),t.setSortBy(["Name"]),t.setPageSize(100).setOffset(0),Backendless.Data.of("Establishment").find(t).then(function(t){for(var n=0;n<t.length;n++)addRow(e,t[n].Name,t[n].Address,t[n].objectId,t[n].objectId);return addRowHandlers(),masterEstablishmentsAustralia=t}).catch(function(e){}).then(()=>{displaySpecials()}),$("#myInput").on("keyup",function(){var e=$(this).val().toLowerCase();$("#myTable tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})})}function onPageLoad(){var e=document.getElementById("establishmentListBox"),t=0,n=Backendless.DataQueryBuilder.create();n.setWhereClause("Country = 'Australia'"),Backendless.Data.of("Establishment").find(n).then(function(n){console.log(n);for(var a=0;a<n.length;a++)e.options[t]=new Option(n[a].Name+" | "+n[a].Address,n[a].objectId),t++;masterEstablishmentsAustralia=n}).catch(function(e){})}function addCell(e,t,n){var a=document.createElement("td");a.id=n,a.innerHTML=t,e.appendChild(a)}function addRow(e,t,n,a,s){var l=document.createElement("tr");addCell(l,t,a),addCell(l,n,s),e.appendChild(l)}function addRowHandlers(){var e=document.getElementById("tbl"),t=e.getElementsByTagName("tr");for(i=0;i<t.length;i++){var n=e.rows[i];n.onclick=function(e){return function(){var t=e.getElementsByTagName("td")[0].id;cellID=t,displaySpecials()}}(n)}}function checkBoxAddToEstablishmentFunc(){if(""==document.getElementById("establishmentId").value)alert("You need to select a valid establishment"),document.getElementById("chkBoxAddToEstablishment").checked=!1;else if(1==document.getElementById("chkBoxAddToEstablishment").checked){document.getElementById("or").style.display="none",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Adding special to "+document.getElementById("name").value+"</h5>",document.getElementById("add_name").value=document.getElementById("name").value,document.getElementById("add_name").disabled=!0,document.getElementById("add_address").value=document.getElementById("address").value,document.getElementById("add_address").disabled=!0,document.getElementById("add_suburb").value=document.getElementById("suburb").value,document.getElementById("add_suburb").disabled=!0,"Establishments - Australia"==document.getElementById("headingLstBoxEstablishments").innerHTML?(document.getElementById("add_country").value="Australia",document.getElementById("add_country").disabled=!0):(document.getElementById("add_country").value="New Zealand",document.getElementById("add_country").disabled=!0),document.getElementById("add_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("add_establishment_type").disabled=!0;var e=document.getElementById("cusineType").value.split(", ");$("#add_cusine_type").val(e),document.getElementById("add_cusine_type").disabled=!0,document.getElementById("files").disabled=!0,document.getElementById("filesText").value=document.getElementById("image-file-name").innerHTML,document.getElementById("filesText").disabled=!0,document.getElementById("skipSpecial").style.display="none",$("select").formSelect(),M.updateTextFields()}else{document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",enableEstablishmentDetails(),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset();var t=document.getElementById("name").value+" | "+document.getElementById("address").value;" | "==t&&(t="Please select an existing establishment."),document.getElementById("addToExistingEstablishment").value=t,document.getElementById("addToExistingEstablishment").name=document.getElementById("establishmentId").value,document.getElementById("skipSpecial").style.display="block",$("select").formSelect(),M.updateTextFields()}}function removeOptions(e){var t;for(t=e.options.length-1;t>=0;t--)e.remove(t)}function removeLastOption(e){e.length>0&&e.remove(e.length-1)}function displaySpecials(){document.getElementById("formSpecialDetails").style.display="none",document.getElementById("formEstablishmentDetails").style.display="block";var e=document.getElementById("establishmentId"),t=document.getElementById("name"),n=document.getElementById("address"),a=document.getElementById("suburb"),s=document.getElementById("postcode"),l=document.getElementById("country"),d=document.getElementById("establishmentType"),o=document.getElementById("cusineType"),i=document.getElementById("image"),m=document.getElementById("image-file-name");/[^\/]*$/.exec("foo/bar/test.html")[0];document.getElementById("formHeading").innerHTML="Establishment details";document.getElementById("establishmentListBox");for(var r=cellID,c=0;c<masterEstablishmentsAustralia.length;c++)masterEstablishmentsAustralia[c].objectId==r&&(e.value=masterEstablishmentsAustralia[c].objectId,t.value=masterEstablishmentsAustralia[c].Name,n.value=masterEstablishmentsAustralia[c].Address,a.value=masterEstablishmentsAustralia[c].Suburb,s.value=masterEstablishmentsAustralia[c].Postcode,l.value=masterEstablishmentsAustralia[c].Country,d.value=masterEstablishmentsAustralia[c].Establishment_Type,o.value=masterEstablishmentsAustralia[c].Cuisine_Type,i.src=masterEstablishmentsAustralia[c].Image,m.innerHTML=/[^\/]*$/.exec(masterEstablishmentsAustralia[c].Image)[0]);var u,g=document.getElementById("specialListBox");removeOptions(g);for(c=0;c<masterEstablishmentsAustralia.length;c++)if(r==masterEstablishmentsAustralia[c].objectId){u=c;for(var y=0;y<masterEstablishmentsAustralia[u].establishmentSpecials.length;y++){var h=y+1+". "+masterEstablishmentsAustralia[u].establishmentSpecials[y].Category.replace("Special ","")+" - "+masterEstablishmentsAustralia[u].establishmentSpecials[y].Description;if(h.length>40&&(h=h.substring(0,40)+".."),masterEstablishmentsAustralia[u].establishmentSpecials[y].Description.length>15)masterEstablishmentsAustralia[u].establishmentSpecials[y].Description.substring(0,25);else masterEstablishmentsAustralia[u].establishmentSpecials[y].Description;g.options[y]=new Option(h,masterEstablishmentsAustralia[u].objectId)}break}M.updateTextFields()}function getSpecial(){try{document.getElementById("formEstablishmentDetails").style.display="none",document.getElementById("formSpecialDetails").style.display="block",document.getElementById("formHeading").innerHTML="Special details";for(var e=document.getElementById("specialListBox"),t=e.options[e.selectedIndex].value,n=e.options[e.selectedIndex].index,a=0;a<masterEstablishmentsAustralia.length;a++)if(t==masterEstablishmentsAustralia[a].objectId){document.getElementById("establishmentIdSpecial").value=masterEstablishmentsAustralia[a].objectId,document.getElementById("specialId").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].objectId;var s=masterEstablishmentsAustralia[a].establishmentSpecials[n].Days_Of_Week;s.replace(/,/g,", ");if(document.getElementById("daysOfWeek").value=s,document.getElementById("startTime").value=tConvert(masterEstablishmentsAustralia[a].establishmentSpecials[n].Start_Time),document.getElementById("endTime").value=tConvert(masterEstablishmentsAustralia[a].establishmentSpecials[n].End_Time),document.getElementById("category").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Category,document.getElementById("typeOfSpecial").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Type_Of_Special,document.getElementById("descriptionFullText").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description,masterEstablishmentsAustralia[a].establishmentSpecials[n].Description.length>125){var l=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description;document.getElementById("description").value=l.substring(0,121)+" ...",$("#tooltip").attr("data-tooltip",masterEstablishmentsAustralia[a].establishmentSpecials[n].Description),$(".material-tooltip").css({display:"block"})}else if(masterEstablishmentsAustralia[a].establishmentSpecials[n].Description.length<=125){document.getElementById("description").value=masterEstablishmentsAustralia[a].establishmentSpecials[n].Description,$("#tooltip").attr("data-tooltip","Less than 120"),$(".material-tooltip").css({display:"none"})}break}M.textareaAutoResize($("#description")),M.updateTextFields()}catch(e){console.log(e),document.getElementById("specialId").value="",document.getElementById("daysOfWeek").value="",document.getElementById("startTime").value="",document.getElementById("endTime").value="",document.getElementById("category").value="",document.getElementById("typeOfSpecial").value="",document.getElementById("description").value="",$(".material-tooltip").css({display:"none"})}}function displayAus(){"Establishments - Australia"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!0,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - Australia")}function displayNZ(){"Establishments - New Zealand"!=document.getElementById("headingLstBoxEstablishments").innerHTML&&($("#myInput").val(""),Australia=!1,onPageLoadTable(),$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("headingLstBoxEstablishments").innerHTML="Establishments - New Zealand")}function toastNotification(e,t,n,a,s,l,d){M.toast({html:'<div class="toast-side"></div><div class="toast-notification-con"><img class="'+t+'" src="../images/'+n+'"><div class="toast-message">'+e+'</div><img class="toast-close" src="../images/toast-close.png" height="16" width="16"></div>',displayLength:s,classes:""+a,outDuration:d}),$(".toast-side").css({"background-color":l}),$(document).on("click",".toast-close",function(){$("#toast-container .toast").fadeOut(500,function(){$("#toast-container .toast").remove()})})}function enableEstablishmentDetails(){document.getElementById("add_name").disabled=!1,document.getElementById("add_address").disabled=!1,document.getElementById("add_suburb").disabled=!1,document.getElementById("add_country").disabled=!1,document.getElementById("add_establishment_type").disabled=!1,document.getElementById("add_cusine_type").disabled=!1,document.getElementById("files").disabled=!1,document.getElementById("filesText").disabled=!1,$("select").formSelect()}function tConvert(e){return(e=e.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/)||[e]).length>1&&((e=e.slice(1))[5]=+e[0]<12?" AM":" PM",e[0]=+e[0]%12||12),e.join("")}function convertTo24Hour2(e){time=document.getElementById(e).value;var t=Number(time.match(/^(\d+)/)[1]),n=Number(time.match(/:(\d+)/)[1]),a=time.match(/\s(.*)$/)[1];"PM"==a&&t<12&&(t+=12),"AM"==a&&12==t&&(t-=12);var s=t.toString(),l=n.toString();return t<10&&(s="0"+s),n<10&&(l="0"+l),s+":"+l}function endAnimations(){document.getElementById("workingAnim").style.display="none",document.getElementById("h5workingAnimMessage").style.display="none"}function daysDebug(){console.log("hi"),console.log($("#add_days_of_the_week").val().join(", "))}function adminDebug(){console.log("testhi")}document.addEventListener("DOMContentLoaded",function(){onPageLoadTable();const e=localStorage.getItem("currentUser");console.log(e),document.getElementById("userEmail").innerHTML="Hi, "+e,$(".tabs").tabs(),$("select").formSelect(),$(".modal").modal(),$("input#input_text, textarea#add_description").characterCounter(),$("input#input_text, textarea#update_description").characterCounter(),M.textareaAutoResize($("#description")),$(".modal-add").modal({startingTop:"4%"}),$(".timepicker").timepicker(),$(".tooltipped").tooltip(),$(".materialboxed").materialbox(),$(".sidenav").sidenav()}),$(function(){$("#tbl").on("click","tbody tr",function(e){$(this).addClass("selected-row").siblings().removeClass("selected-row")})}),addBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),document.getElementById("addConfirmBtn").classList.remove("modal-close"),document.getElementById("addSkipSpecialBtn").classList.remove("modal-close");var t=document.getElementById("name").value+" | "+document.getElementById("address").value;if(" | "==t&&(t="Please select an existing establishment."),document.getElementById("addToExistingEstablishment").value=t,document.getElementById("addToExistingEstablishment").name=document.getElementById("establishmentId").value,0==document.getElementById("chkBoxAddToEstablishment").checked){var n=Backendless.DataQueryBuilder.create();return n.setSortBy(["Name"]),n.setPageSize(100).setOffset(0),Backendless.Data.of("Cuisine").find(n).then(function(e){var t=document.getElementById("add_cusine_type");$("#add_cusine_type").empty();var n=1,a=0,s=e.length;for(a=0;a<s;a++)t.options[0]=new Option("Choose your cuisine type",""),t.options[0].disabled=!0,t.options[n]=new Option(e[a].Name,e[a].Name),n++;$("select").formSelect()}).catch(function(e){})}}),addConfirmBtn.addEventListener("click",e=>{if(M.Toast.dismissAll(),0==document.getElementById("chkBoxAddToEstablishment").checked){console.log("Create new establishment and special concurrently");var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_postcode").value.trim(),a=document.getElementById("add_country").value,s=document.getElementById("add_establishment_type").value,l=$("#add_cusine_type").val().join(", "),d=document.getElementById("filesText").value.trim(),o=document.getElementById("add_address").value.trim(),i=document.getElementById("add_suburb").value.trim(),m=$("#add_days_of_the_week").val().join(", "),r=document.getElementById("add_start_time").value,c=document.getElementById("add_end_time").value,u=document.getElementById("add_category").value,g=document.getElementById("add_type_of_special").value,y=document.getElementById("add_description").value.trim();if(""==t||t.length>50||""==o||o.length>50||""!=o&&!o.match(/^[a-zA-Z0-9\/\- ]+$/)||""==i||i.length>50||""!=i&&!i.match(/^[A-Za-z ]+$/)||""==n||n.length>4||""!=n&&!n.match(/^[0-9]+$/)||""==a||""==s||""==l||""==d||""==m||""==r||""==c||""==u||""==g||""==y||y.length>500){var h="";""==t&&(h+='"Name" is required!<br>'),t.length>50&&(h+='"Name" must be less than 50 characters!<br>'),""==o&&(h+='"Address" is required!<br>'),o.length>50&&(h+='"Address" must be less than 50 characters!<br>'),""==o||o.match(/^[a-zA-Z0-9\/\- ]+$/)||(h+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==i&&(h+='"Suburb" is required!<br>'),i.length>50&&(h+='"Suburb" must be less than 50 characters!<br>'),""==i||i.match(/^[A-Za-z ]+$/)||(h+='"Suburb" contains non-alphabetic characters!<br>'),""==n&&(h+='"Postcode" is required!<br>'),n.length>4&&(h+='"Postcode" must be no more than 4 numbers!<br>'),""==n||n.match(/^[0-9]+$/)||(h+='"Postcode" contains non-numerical characters!<br>'),""==a&&(h+='"Country" is required!<br>'),""==s&&(h+='"Establishment Type" is required!<br>'),""==l&&(h+='"Cuisine Type" is required!<br>'),""==d&&(h+='"Image" is required!<br>'),""==m&&(h+='"Days of the week" is required!<br>'),""==r&&(h+='"Start time" is required!<br>'),""==c&&(h+='"End time" is required!<br>'),""==u&&(h+='"Category" is required!<br>'),""==g&&(h+='"Type of special" is required!<br>'),""==y&&(h+='"Description" is required!<br>'),y.length>500&&(h+='"Description" must be less than 500 characters!<br>'),toastNotification(h,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),e.preventDefault()}else{var p;document.getElementById("addConfirmBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var b,E,I=o+" "+i,B=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:I,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return b=e.data.results[0].geometry.location.lat,E=e.data.results[0].geometry.location.lng,console.log(b+" : "+E),B.push(b),B.push(E),B}).then(()=>(file=document.getElementById("files").files[0],console.log(document.getElementById("files").files[0].name),Backendless.Files.upload(file,"images").then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),p=e.fileURL}).catch(function(e){"Error: Unable to upload the file: file already exists"==e&&(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()),console.log(e)}))).then(()=>{Promise.all([(()=>{console.log(B),console.log(B[0]),console.log(B[1]);var e={Image:p,Location:(new Backendless.Data.Point).setLatitude(B[0]).setLongitude(B[1]),Name:t,Address:o,Suburb:i,Country:a,Cuisine_Type:l,Establishment_Type:s};return Backendless.Data.of("Establishment").save(e).then(e=>e.objectId)})(),(()=>{var e={Days_Of_Week:m,Start_Time:r,End_Time:c,Category:u,Type_Of_Special:g,Description:y};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)})()]).then(([e,t])=>{console.log(e),console.log(t);var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){console.log("relation has been set"),console.log("1. Finished creating establishment and special concurrently")})}).then(()=>{console.log("Data Successfully Written")}).then(()=>{console.log("2. loading onPageLoadTable() from inside .then() "),onPageLoadTable()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment and Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{M.updateTextFields()}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e)),"Error: Field 'Image' doesn't have a default value"==e?endAnimations():(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()),console.error(e)})})}}else if(1==document.getElementById("chkBoxAddToEstablishment").checked){m=$("#add_days_of_the_week").val().join(", "),r=document.getElementById("add_start_time").value,c=document.getElementById("add_end_time").value,u=document.getElementById("add_category").value,g=document.getElementById("add_type_of_special").value,y=document.getElementById("add_description").value.trim();if(""==m||""==r||""==c||""==u||""==g||""==y||y.length>500){h="";""==m&&(h+='"Days of the week" is required!<br>'),""==r&&(h+='"Start time" is required!<br>'),""==c&&(h+='"End time" is required!<br>'),""==u&&(h+='"Category" is required!<br>'),""==g&&(h+='"Type of special" is required!<br>'),""==y&&(h+='"Description" is required!<br>'),y.length>500&&(h+='"Description" must be less than 500 characters!<br>'),toastNotification(h,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}else{document.getElementById("addConfirmBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";const e=()=>establishmentObjectId=document.getElementById("addToExistingEstablishment").name,t=()=>{var e={Days_Of_Week:m,Start_Time:r,End_Time:c,Category:u,Type_Of_Special:g,Description:y};return Backendless.Data.of("Special").save(e).then(e=>e.objectId)};Promise.all([e(),t()]).then(([e,t])=>{console.log(e),console.log(t);var n={objectId:e},a=[{objectId:t}];return cellID=e,Backendless.Data.of("Establishment").addRelation(n,"establishmentSpecials",a).then(function(e){console.log("relation has been set")}).catch(function(e){console.log("server reported an error - "+e.message)})}).then(()=>{onPageLoadTable()}).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{enableEstablishmentDetails()}).then(()=>{document.getElementById("or").style.display="block",document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",document.getElementById("skipSpecial").style.display="block"}).then(()=>{M.updateTextFields()}).catch(e=>{console.error(e)})}}}),addCancelBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),document.getElementById("addCancelBtn").setAttribute("href","#"),console.log(document.getElementById("addCancelBtn").getAttribute("href"));var t=document.getElementById("add_name").value.trim(),n=document.getElementById("add_country").value,a=document.getElementById("add_establishment_type").value,s=document.getElementById("add_cusine_type").value,l=document.getElementById("add_address").value.trim(),d=document.getElementById("add_suburb").value.trim(),o=$("#add_days_of_the_week").val().join(", "),i=document.getElementById("add_start_time").value,m=document.getElementById("add_end_time").value,r=document.getElementById("add_category").value,c=document.getElementById("add_type_of_special").value,u=document.getElementById("add_description").value.trim(),g=!0;(0!=document.getElementById("chkBoxAddToEstablishment").checked||""!=t||""!=n||""!=a||""!=s||""!=l||""!=d)&&1!=document.getElementById("chkBoxAddToEstablishment").checked||""!=o||""!=i&&"10:00:00"!=i||""!=m&&"18:00:00"!=m||""!=r||""!=c||""!=u||($("#modal1").modal("close"),enableEstablishmentDetails(),addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset(),document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",g=!1),1==g&&(document.getElementById("addCancelBtn").setAttribute("href","#modalAddCancelConfirm"),console.log(document.getElementById("addCancelBtn").getAttribute("href")))}),addCancelConfirmDiscardBtn.addEventListener("click",e=>{addspecialForm=document.querySelector("#addspecial-form"),addspecialForm.reset(),enableEstablishmentDetails(),document.getElementById("addSpecialSubHeading").innerHTML="<h5>Create for a new establishment</h5>",$("select").formSelect(),$("#modal1").modal("close"),$("#modalAddCancelConfirm").modal("close"),$("input#input_text, textarea#add_description").characterCounter()}),addSkipSpecialBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll();var t=document.getElementById("add_address").value.trim(),n=document.getElementById("add_suburb").value.trim(),a=document.getElementById("add_name").value.trim(),s=document.getElementById("add_postcode").value.trim(),l=document.getElementById("add_country").value,d=document.getElementById("add_establishment_type").value,o=$("#add_cusine_type").val().join(", ");if(""==a||a.length>50||""==t.trim()||t.length>50||""!=t&&!t.match(/^[a-zA-Z0-9\/\- ]+$/)||""==n||n.length>50||""!=n&&!n.match(/^[A-Za-z ]+$/)||""==s||s.length>4||""!=s&&!s.match(/^[0-9]+$/)||""==l||""==d||""==o){var i="";""==a&&(i+='"Name" is required!<br>'),a.length>50&&(i+='"Name" must be less than 50 characters!<br>'),""==t&&(i+='"Address" is required!<br>'),t.length>50&&(i+='"Address" must be less than 50 characters!<br>'),""==t||t.match(/^[a-zA-Z0-9\/\- ]+$/)||(i+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==n&&(i+='"Suburb" is required!<br>'),n.length>50&&(i+='"Suburb" must be less than 50 characters!<br>'),""==n||n.match(/^[A-Za-z ]+$/)||(i+='"Suburb" contains non-alphabetic characters!<br>'),""==s&&(i+='"Postcode" is required!<br>'),s.length>4&&(i+='"Postcode" must be no more than 4 numbers!<br>'),""==s||s.match(/^[0-9]+$/)||(i+='"Postcode" contains non-numerical characters!<br>'),""==l&&(i+='"Country" is required!<br>'),""==d&&(i+='"Establishment Type" is required!<br>'),""==o&&(i+='"Cuisine Type" is required!<br>'),toastNotification(i,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}else{var m;document.getElementById("addSkipSpecialBtn").classList.add("modal-close"),document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Creating",document.getElementById("h5workingAnimMessage").style.display="block";var r,c,u=t+" "+n,g=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:u,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return r=e.data.results[0].geometry.location.lat,c=e.data.results[0].geometry.location.lng,console.log(r+" : "+c),g.push(r),g.push(c),g}).then(()=>(file=document.getElementById("files").files[0],Backendless.Files.upload(file,"images").then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),m=e.fileURL}))).then(()=>{var e={Image:m,Location:(new Backendless.Data.Point).setLatitude(g[0]).setLongitude(g[1]),Name:a,Address:t,Suburb:n,Postcode:s,Country:l,Cuisine_Type:o,Establishment_Type:d};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("new establishment instance alone has been saved"),cellID=e.objectId,console.log(e),$("#debugImage").attr("src",e.Image)})}).then(()=>{console.log("Data Successfully Written")}).then(()=>{onPageLoadTable()}).then(()=>{document.querySelector("#addspecial-form").reset()}).then(()=>{M.updateTextFields()}).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been created successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e)),"Error: Unable to upload the file: file already exists"==e?(toastNotification("A file with the name "+document.getElementById("files").files[0].name+" already exists.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()):(toastNotification(e.message,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations()),console.error(e)})}}),updateBtn.addEventListener("click",e=>{if(e.preventDefault(),M.Toast.dismissAll(),""==document.getElementById("establishmentId").value)document.getElementById("updateBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{if("Establishment details"==document.getElementById("formHeading").innerHTML){document.getElementById("updateBtn").setAttribute("href","#modal2"),console.log("updating establishment details"),document.getElementById("formUpdateSpecialDetails").style.display="none",document.getElementById("formUpdateEstablishmentDetails").style.display="block",document.getElementById("updateHeading").innerHTML="Update establishment",document.getElementById("update_establishmentId").value=document.getElementById("establishmentId").value,document.getElementById("update_name").value=document.getElementById("name").value,document.getElementById("update_address").value=document.getElementById("address").value,document.getElementById("update_suburb").value=document.getElementById("suburb").value,document.getElementById("update_postcode").value=document.getElementById("postcode").value,document.getElementById("update_country").value=document.getElementById("country").value,document.getElementById("update_establishment_type").value=document.getElementById("establishmentType").value,document.getElementById("update-image-file-name").innerHTML=document.getElementById("image-file-name").innerHTML,document.getElementById("updateimage").src=document.getElementById("image").src,$("select").formSelect(),M.updateTextFields();var t=Backendless.DataQueryBuilder.create();return t.setSortBy(["Name"]),t.setPageSize(100).setOffset(0),Backendless.Data.of("Cuisine").find(t).then(function(e){var t=document.getElementById("update_cusine_type");$("#update_cusine_type").empty();var n=1,a=0,s=e.length;for(a=0;a<s;a++)t.options[0]=new Option("Choose your cuisine type",""),t.options[0].disabled=!0,t.options[n]=new Option(e[a].Name,e[a].Name),n++}).then(()=>{var e=document.getElementById("cusineType").value.split(", ");$("#update_cusine_type").val(e),$("select").formSelect()}).catch(function(e){})}if("Special details"==document.getElementById("formHeading").innerHTML)if(""==document.getElementById("specialId").value)console.log("In special"),document.getElementById("updateBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0);else{document.getElementById("updateBtn").setAttribute("href","#modal2"),M.textareaAutoResize($("#update_description")),document.getElementById("updateHeading").innerHTML="Update special",document.getElementById("formUpdateEstablishmentDetails").style.display="none",document.getElementById("formUpdateSpecialDetails").style.display="block";var n=document.getElementById("daysOfWeek").value;console.log(n);var a=n.split(", ");console.log(a),$("#update_days_of_the_week").val(a),document.getElementById("update_start_time").value=convertTo24Hour2("startTime"),document.getElementById("update_end_time").value=convertTo24Hour2("endTime"),document.getElementById("update_category").value=document.getElementById("category").value,document.getElementById("update_type_of_special").value=document.getElementById("typeOfSpecial").value,document.getElementById("update_description").value=document.getElementById("descriptionFullText").value,console.log("hi"),console.log(document.getElementById("descriptionFullText").value),M.textareaAutoResize($("#update_description"))}}$("select").formSelect(),M.updateTextFields()}),updateConfirmBtn.addEventListener("click",e=>{if(e.preventDefault(),"Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("establishmentId").value.trim(),n=document.getElementById("update_name").value.trim(),a=document.getElementById("update_address").value.trim(),s=document.getElementById("update_suburb").value.trim(),l=document.getElementById("update_postcode").value.trim(),d=document.getElementById("update_country").value,o=document.getElementById("update_establishment_type").value,i=$("#update_cusine_type").val().join(", ");if(""==n||n.length>50||""==a||a.length>50||""!=a&&!a.match(/^[a-zA-Z0-9\/\- ]+$/)||""==s||s.length>50||""!=s&&!s.match(/^[A-Za-z ]+$/)||""==l||l.length>4||""!=l&&!l.match(/^[0-9]+$/)||""==d||""==o||""==i){var m="";""==n&&(m+='"Name" is required!<br>'),n.length>50&&(m+='"Name" must be less than 50 characters!<br>'),""==a&&(m+='"Address" is required!<br>'),a.length>50&&(m+='"Address" must be less than 50 characters!<br>'),""==a||a.match(/^[a-zA-Z0-9\/\- ]+$/)||(m+='"Address" contains non-alphanumerical characters! Exception ("/", "-").<br>'),""==s&&(m+='"Suburb" is required!<br>'),s.length>50&&(m+='"Suburb" must be less than 50 characters!<br>'),""==s||s.match(/^[A-Za-z ]+$/)||(m+='"Suburb" contains non-alphabetic characters!<br>'),""==l&&(m+='"Postcode" is required!<br>'),l.length>4&&(m+='"Postcode" must be no more than 4 numbers!<br>'),""==l||l.match(/^[0-9]+$/)||(m+='"Postcode" contains non-numerical characters!<br>'),""==d&&(m+='"Country" is required!<br>'),""==o&&(m+='"Establishment Type" is required!<br>'),""==i&&(m+='"Cuisine Type" is required!<br>'),toastNotification(m,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),e.preventDefault()}else if(document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block",document.getElementById("address").value==a&&document.getElementById("suburb").value==s||""==document.getElementById("updateFiles").value){if(document.getElementById("address").value==a&&document.getElementById("suburb").value==s){if(""!=document.getElementById("updateFiles").value)return console.log("File changed"),file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),c=e.fileURL}).then(()=>{var e={Image:c,objectId:t,Name:n,Address:a,Suburb:s,Country:d,Establishment_Type:o,Cuisine_Type:i};return cellID=t,Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)})}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).catch(e=>{console.error(e)});if(document.getElementById("name").value!=document.getElementById("update_name").value||document.getElementById("postcode").value!=document.getElementById("update_postcode").value||document.getElementById("country").value!=document.getElementById("update_country").value||document.getElementById("establishmentType").value!=document.getElementById("update_establishment_type").value||document.getElementById("cusineType").value!=document.getElementById("update_cusine_type").value){console.log("Non file or address changed");var r={objectId:t,Name:n,Postcode:l,Address:a,Suburb:s,Country:d,Establishment_Type:o,Cuisine_Type:i};return Backendless.Data.of("Establishment").save(r).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{}).catch(e=>{console.error(e)})}return void endAnimations()}console.log("Address changed");y=a+" "+s,h=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:y,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return u=e.data.results[0].geometry.location.lat,g=e.data.results[0].geometry.location.lng,console.log(u+" : "+g),h.push(u),h.push(g),h}).then(()=>{var e={Location:(new Backendless.Data.Point).setLatitude(h[0]).setLongitude(h[1]),objectId:t,Name:n,Address:a,Suburb:s,Country:d,Establishment_Type:o,Cuisine_Type:i};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)})}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e))})}else{var c;console.log("Address and file changed");var u,g,y=a+" "+s,h=[];axios.get("https://maps.googleapis.com/maps/api/geocode/json?components=country:NZ|country:AU",{params:{address:y,key:"AIzaSyBmpzz0lX4w2UV3KXivbLrQ3AHJUvOzbOI"}}).then(function(e){return u=e.data.results[0].geometry.location.lat,g=e.data.results[0].geometry.location.lng,console.log(u+" : "+g),h.push(u),h.push(g),h}).then(()=>(file=document.getElementById("updateFiles").files[0],Backendless.Files.upload(file,"images",!0).then(function(e){console.log("File successfully uploaded. Path to download: "+e.fileURL),c=e.fileURL}))).then(()=>{var e={Image:c,Location:(new Backendless.Data.Point).setLatitude(h[0]).setLongitude(h[1]),objectId:t,Name:n,Address:a,Suburb:s,Country:d,Establishment_Type:o,Cuisine_Type:i};return Backendless.Data.of("Establishment").save(e).then(function(e){console.log("Establishment instance has been updated"),console.log(e)}).catch(function(e){console.log("an error has occurred "+e.message)})}).then(()=>onPageLoadTable()).then(()=>{document.getElementById("workingAnim").style.display="none"}).then(()=>{document.getElementById("h5workingAnimMessage").style.display="none"}).then(()=>{toastNotification("Establishment has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("name").value=document.getElementById("update_name").value,document.getElementById("address").value=document.getElementById("update_address").value,document.getElementById("suburb").value=document.getElementById("update_suburb").value,document.getElementById("country").value=document.getElementById("update_country").value,document.getElementById("establishmentType").value=document.getElementById("update_establishment_type").value,document.getElementById("cusineType").value=document.getElementById("update_cusine_type").value}).catch(e=>{"TypeError: Cannot read property 'geometry' of undefined"==e&&(toastNotification("An error was encountered while handling the request. The address and/or suburb was unable to be identified.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0),endAnimations(),console.error(e))})}}else if("Special details"==document.getElementById("formHeading").innerHTML){var p=document.getElementById("specialId").value,b=$("#update_days_of_the_week").val().join(", "),E=document.getElementById("update_start_time").value,I=document.getElementById("update_end_time").value,B=document.getElementById("update_category").value,f=document.getElementById("update_type_of_special").value,v=document.getElementById("update_description").value;if(!(""==b||""==E||""==I||""==B||""==f||""==v||v.length>500)){document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Updating",document.getElementById("h5workingAnimMessage").style.display="block";var _={objectId:p,Days_Of_Week:b,Start_Time:E,End_Time:I,Category:B,Type_Of_Special:f,Description:v};return Backendless.Data.of("Special").save(_).then(function(e){console.log("Special instance has been updated")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>onPageLoadTable()).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been updated successfully!","toast-tick","white-check-mark.png","green",4e3,"#2d995b",375)}).then(()=>{document.getElementById("startTime").value=tConvert(document.getElementById("update_start_time").value),document.getElementById("endTime").value=tConvert(document.getElementById("update_end_time").value),document.getElementById("category").value=document.getElementById("update_category").value,document.getElementById("typeOfSpecial").value=document.getElementById("update_type_of_special").value,document.getElementById("description").value=document.getElementById("update_description").value}).catch(e=>{console.error(e)})}m="";""==b&&(m+='"Days of the week" is required!<br>'),""==E&&(m+='"Start time" is required!<br>'),""==I&&(m+='"End time" is required!<br>'),""==B&&(m+='"Category" is required!<br>'),""==f&&(m+='"Type of special" is required!<br>'),""==v&&(m+='"Description" is required!<br>'),v.length>500&&(m+='"Description" must be less than 500 characters!<br>'),toastNotification(m,"toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}}),updateCancelBtn.addEventListener("click",e=>{e.preventDefault(),updateForm=document.querySelector("#updatespecial-form"),updateForm.reset()}),deleteBtn.addEventListener("click",e=>{e.preventDefault(),M.Toast.dismissAll(),""==document.getElementById("establishmentId").value?(document.getElementById("deleteBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)):"Establishment details"==document.getElementById("formHeading").innerHTML?(document.getElementById("deleteBtn").setAttribute("href","#modalDeleteCancelConfirm"),document.getElementById("establishmentToDelete").innerHTML=document.getElementById("name").value,document.getElementById("deleteConfirmHeading").innerHTML="Are you sure you want to delete the establishment?"):"Special details"==document.getElementById("formHeading").innerHTML&&(""==document.getElementById("specialId").value?(console.log("In special"),document.getElementById("deleteBtn").setAttribute("href","#"),toastNotification("No establishment or special selected.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)):(document.getElementById("deleteBtn").setAttribute("href","#modalDeleteCancelConfirm"),document.getElementById("establishmentToDelete").innerHTML=document.getElementById("name").value,document.getElementById("deleteConfirmHeading").innerHTML="Are you sure you want to delete the "+document.getElementById("category").value+"?"))}),deleteCancelConfirmDeleteBtn.addEventListener("click",e=>{if(e.preventDefault(),"Establishment details"==document.getElementById("formHeading").innerHTML){var t=document.getElementById("establishmentId").value;console.log(t);for(var n=0;n<masterEstablishmentsAustralia.length;n++)if(masterEstablishmentsAustralia[n].objectId==t){if(!(masterEstablishmentsAustralia[n].establishmentSpecials.length>0)){document.getElementById("workingAnim").style.display="block",document.getElementById("h5workingAnimMessage").innerHTML="Deleting",document.getElementById("h5workingAnimMessage").style.display="block";var a=/[^\/]*$/.exec(masterEstablishmentsAustralia[n].Image)[0];return Backendless.Files.remove("images/"+a).then(function(){console.log("file has been deleted")}).catch(function(e){console.log("error - "+e.message)}),Backendless.Data.of("Establishment").remove({objectId:t}).then(function(e){console.log("Establishment instance has been deleted")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{onPageLoadTable()}).then(()=>{$("#specialListBox").empty(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset(),document.getElementById("addToExistingEstablishment").value="",console.log(document.getElementById("addToExistingEstablishment").value),document.getElementById("image-file-name").innerHTML="",$("#image").removeAttr("src")}).then(()=>{endAnimations()}).then(()=>{toastNotification("Establishment has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).catch(e=>{console.error(e)})}toastNotification("The establishment must contain no specials in order to delete.","toast-error","error-symbol.png","red lighten-1","Infinity","#ce5548",0)}}else if("Special details"==document.getElementById("formHeading").innerHTML){var s=document.getElementById("specialId").value;return Backendless.Data.of("Special").remove({objectId:s}).then(function(e){console.log("Special instance has been deleted")}).catch(function(e){console.log("an error has occurred "+e.message)}).then(()=>{$("#specialListBox option:selected").remove(),displayEstablishmentandSpecialForm=document.querySelector("#displayEstablishmentandSpecial-form"),displayEstablishmentandSpecialForm.reset()}).then(()=>{onPageLoadTable()}).then(()=>{endAnimations()}).then(()=>{toastNotification("Special has been deleted successfully!","toast-tick","white-check-mark.png","light-blue darken-2",4e3,"#0277bd",375)}).catch(e=>{console.error(e)})}console.log("confirm deletion")}),jQuery(".white-text").click(function(e){console.log("gii"),jQuery(".selected-sidenav").removeClass("selected-sidenav"),jQuery(this).addClass("selected-sidenav")});